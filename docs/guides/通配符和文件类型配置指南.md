# 通配符和文件类型配置指南

**更新日期**: 2025-11-02  
**功能**: Auto-Reload 文件类型自定义和通配符支持

---

## 📖 概述

从 v1.0 开始，Auto-Reload 支持：
- ✅ 自定义监控文件类型
- ✅ 通配符模式匹配
- ✅ 全局和插件特定配置

---

## 🎯 基础用法

### 默认配置

默认情况下，Auto-Reload 监控：
- ✅ main.js（必选）
- ✅ manifest.json
- ✅ styles.css

这已经覆盖了大多数场景。

### 添加自定义文件

如果您的插件还有其他重要文件需要监控：

**步骤**:
1. 打开设置页面
2. 找到"监控文件类型"区域
3. 在"自定义文件"文本框中，每行添加一个文件名：
   ```
   data.json
   config.yaml
   settings.json
   ```
4. 保存（自动）

**效果**: 现在修改这些文件也会触发自动重载！

---

## ⭐ 通配符使用

### 支持的通配符

- `*` - 匹配任意字符（不包括 `/`）
- 支持路径中的通配符

### 基础示例

#### 示例 1：匹配所有特定扩展名文件

```
*.json     → 匹配插件根目录下所有 JSON 文件
*.css      → 匹配所有 CSS 文件
*.yaml     → 匹配所有 YAML 文件
```

**匹配示例**:
- `data.json` ✓
- `config.json` ✓
- `settings.json` ✓
- `lang/en.json` ✗（在子目录中）

#### 示例 2：匹配子目录中的文件

```
lang/*.json      → 匹配 lang 目录下所有 JSON
config/*.yaml    → 匹配 config 目录下所有 YAML
data/*.json      → 匹配 data 目录下所有 JSON
```

**匹配示例**（lang/*.json）:
- `lang/en.json` ✓
- `lang/zh.json` ✓
- `lang/ja.json` ✓
- `en.json` ✗（不在 lang 目录）
- `lang/sub/en.json` ✗（在子子目录）

#### 示例 3：匹配特定前缀

```
data-*.json    → data-开头的 JSON 文件
config-*.yaml  → config-开头的 YAML 文件
```

**匹配示例**（data-*.json）:
- `data-user.json` ✓
- `data-settings.json` ✓
- `user-data.json` ✗（前缀不对）

### 高级示例

#### 多层目录匹配

**注意**: 当前版本 `*` 不匹配 `/`，如需匹配多层目录，需要明确指定路径。

**正确**:
```
lang/en/*.json       → lang/en 目录下的 JSON
lang/zh/*.json       → lang/zh 目录下的 JSON
```

**不正确**:
```
lang/*/*.json        → 不支持（* 不匹配 /）
```

**解决方案**: 分别添加每个目录的模式

#### 组合使用

```
*.json           → 根目录所有 JSON
lang/*.json      → lang 目录 JSON
config/*.yaml    → config 目录 YAML
data-*.json      → data- 前缀的 JSON
```

---

## 🔧 配置模式

### 全局配置（默认，推荐）

**适用场景**: 所有插件使用相同的文件类型设置

**配置方式**:
1. 打开设置页面
2. "配置模式" 选择 "全局配置"
3. 设置要监控的文件类型
4. 所有插件都使用这个配置

**优点**:
- ✅ 简单易用
- ✅ 一次配置，所有插件生效
- ✅ 适合大多数场景

### 插件特定配置

**适用场景**: 不同插件需要监控不同的文件

**配置方式**:
1. 打开设置页面
2. "配置模式" 选择 "插件特定配置"
3. 为每个插件启用"使用特定配置"
4. 单独设置每个插件的文件类型

**优点**:
- ✅ 灵活性高
- ✅ 精确控制
- ✅ 避免不必要的重载

**配置示例**:

```
my-data-plugin:
  ✓ main.js
  ✓ manifest.json
  ✗ styles.css
  自定义：data.json, lang/*.json

my-ui-plugin:
  ✓ main.js
  ✗ manifest.json
  ✓ styles.css
  自定义：icons/*.svg, themes/*.css
```

---

## 💡 最佳实践

### 1. 从默认配置开始

大多数情况下，默认配置已经足够：
```
✓ main.js
✓ manifest.json
✓ styles.css
```

### 2. 按需添加自定义文件

只添加确实需要监控的文件：
```
✓ data.json        （如果有数据文件）
✓ lang/*.json      （如果支持多语言）
✓ config/*.yaml    （如果有配置文件）
```

### 3. 使用通配符减少配置

**不推荐**（重复）:
```
lang/en.json
lang/zh.json
lang/ja.json
lang/fr.json
```

**推荐**（通配符）:
```
lang/*.json
```

### 4. 避免过度监控

**不要**添加不需要的文件：
- ❌ `*.md`（文档通常不影响插件功能）
- ❌ `README.md`（不需要重载）
- ❌ `package.json`（npm 依赖变化需要重新构建）

### 5. 使用插件特定配置处理特殊情况

如果某个插件需要特殊的监控设置，使用插件特定配置，其他插件保持全局默认。

---

## 🧪 测试示例

### 场景 1：多语言插件开发

**需求**: 插件支持多语言，语言文件在 `lang/` 目录下

**配置**:
```
自定义文件：
lang/*.json
```

**测试**:
1. 修改 `lang/en.json`
2. 保存
3. 等待 1-2 秒

**预期**: 自动重载 ✓

### 场景 2：主题插件开发

**需求**: 插件有多个主题文件

**配置**:
```
✓ main.js
✓ manifest.json
✓ styles.css

自定义文件：
themes/*.css
icons/*.svg
```

**测试**:
1. 修改 `themes/dark.css`
2. 保存

**预期**: 自动重载 ✓

### 场景 3：数据驱动插件

**需求**: 插件使用 JSON 数据文件

**配置**:
```
自定义文件：
data/*.json
*.json
```

**测试**:
1. 修改 `data/users.json`
2. 保存

**预期**: 自动重载 ✓

---

## 🐛 常见问题

### Q: 通配符不工作？

**A**: 检查以下几点：
1. 通配符语法是否正确（`*.json` 不是 `*json`）
2. 文件路径是否正确（区分大小写）
3. 文件是否在插件目录下
4. 查看控制台是否有错误日志

**调试方法**:
```javascript
// 在控制台测试匹配
const { matchPattern } = require('./shared/utils');
console.log(matchPattern('lang/en.json', 'lang/*.json'));  // 应该返回 true
```

### Q: 全局和插件特定配置哪个优先？

**A**: 插件特定配置优先于全局配置

```
全局配置：*.json
plugin-A 特定：data.json

结果：
- plugin-A 只监控 data.json
- 其他插件监控所有 *.json
```

### Q: 可以监控 node_modules 中的文件吗？

**A**: 技术上可以，但不推荐

```
node_modules/*/*.js    # 可以，但会监控大量文件
```

**建议**: 只监控您编写的文件

### Q: 性能影响如何？

**A**: 非常小

- 通配符匹配在启动和配置变化时执行一次
- 之后只检查已知文件的时间戳
- CPU < 0.1%, 内存 < 5MB

---

## ✅ 配置检查清单

配置前检查：

- [ ] 文件名是否正确
- [ ] 路径是否正确
- [ ] 通配符语法是否正确
- [ ] 文件是否在插件目录下
- [ ] 是否真的需要监控这个文件

---

**维护者**: LINYF510  
**最后更新**: 2025-11-02

