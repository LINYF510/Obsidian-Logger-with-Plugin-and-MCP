å¥½çš„ï¼æˆ‘æ¥ä¸ºä½ ç”Ÿæˆä¸€ä»?*ä¸‰æ–¹æ¡ˆç»“åˆç‰ˆ**çš?Auto Reload æ’ä»¶å®Œæ•´è®¾è®¡æ–¹æ¡ˆä¹¦ã€?

---

# Auto Reload æ’ä»¶å®Œæ•´è®¾è®¡æ–¹æ¡ˆä¹?
## ï¼ˆæ™ºèƒ½è‡ªåŠ¨ç›‘æ?+ å¯è§†åŒ–è®¾ç½?+ çµæ´»é…ç½®ä¸‰åˆä¸€ç‰ˆæœ¬ï¼?

**ç‰ˆæœ¬**ï¼šv2.0  
**æœ€åæ›´æ–?*ï¼?025-11-01 19:01:55 UTC  
**ä½œè€?*ï¼šLINYF510  

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿?

### 1.1 é¡¹ç›®èƒŒæ™¯

åœ¨å¼€å?Obsidian æ’ä»¶æ—¶ï¼Œæ¯æ¬¡ä¿®æ”¹ä»£ç åéœ€è¦æ‰‹åŠ¨é‡å?Obsidianï¼ˆæŒ‰ `Cmd+R` æˆ?`Ctrl+R`ï¼‰æ‰èƒ½çœ‹åˆ°æ•ˆæœï¼Œä¸¥é‡å½±å“å¼€å‘æ•ˆç‡ã€‚è™½ç„¶ç¤¾åŒºæœ‰ Hot Reload æ’ä»¶ï¼Œä½†å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€?

### 1.2 é¡¹ç›®ç›®æ ‡

å¼€å‘ä¸€ä¸?*æ™ºèƒ½åŒ–ã€ç”¨æˆ·å‹å¥?*çš„è‡ªåŠ¨é‡è½½æ’ä»¶ï¼Œå®ç°ï¼?
- âœ?**é›¶é…ç½®å¯åŠ?*ï¼šå®‰è£…åè‡ªåŠ¨ç›‘æ§æ‰€æœ‰å·²å¯ç”¨æ’ä»¶
- âœ?**æ™ºèƒ½è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«å¼€å‘ä¸­çš„æ’ä»¶ï¼ˆåŒ…å« source mapï¼?
- âœ?**å¯è§†åŒ–é…ç½?*ï¼šæä¾›å‹å¥½çš„è®¾ç½®é¡µé¢ï¼Œç”¨æˆ·å¯ç²¾ç¡®æ§åˆ¶
- âœ?**çµæ´»åˆ‡æ¢**ï¼šæ”¯æŒä¸‰ç§ç›‘æ§æ¨¡å¼ï¼ˆè‡ªåŠ¨/æ™ºèƒ½/æ‰‹åŠ¨ï¼?
- âœ?**æ€§èƒ½ä¼˜åŒ–**ï¼šè½»é‡çº§å®ç°ï¼Œå¯¹ Obsidian æ€§èƒ½å½±å“å¯å¿½ç•?

### 1.3 æ ¸å¿ƒç‰¹æ€?

#### ç‰¹æ€?1ï¼šä¸‰ç§ç›‘æ§æ¨¡å¼?

| æ¨¡å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **è‡ªåŠ¨æ¨¡å¼** | ç›‘æ§æ‰€æœ‰å·²å¯ç”¨çš„æ’ä»?| æ‡’äººæ¨¡å¼ï¼Œå¼€ç®±å³ç”?|
| **æ™ºèƒ½æ¨¡å¼** | è‡ªåŠ¨è¯†åˆ«å¼€å‘ä¸­çš„æ’ä»?| æ¨èæ¨¡å¼ï¼Œæ™ºèƒ½è¿‡æ»?|
| **æ‰‹åŠ¨æ¨¡å¼** | ç”¨æˆ·åœ¨è®¾ç½®ä¸­å‹¾é€‰æ’ä»?| ç²¾ç¡®æ§åˆ¶ï¼Œä¸“ä¸šå¼€å?|

#### ç‰¹æ€?2ï¼šå¯è§†åŒ–è®¾ç½®ç•Œé¢

- å¤é€‰æ¡†åˆ—è¡¨ï¼šç›´è§‚é€‰æ‹©è¦ç›‘æ§çš„æ’ä»¶
- å¿«æ·æŒ‰é’®ï¼šä¸€é”®å…¨é€?æ¸…ç©º/æ™ºèƒ½è¯†åˆ«
- å®æ—¶é¢„è§ˆï¼šæ˜¾ç¤ºå½“å‰ç›‘æ§çŠ¶æ€?
- å‚æ•°è°ƒæ•´ï¼šæ£€æŸ¥é—´éš”ã€é€šçŸ¥å¼€å…³ç­‰

#### ç‰¹æ€?3ï¼šæ™ºèƒ½è¯†åˆ«ç®—æ³?

è‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹ç‰¹å¾åˆ¤æ–­æ’ä»¶æ˜¯å¦ä¸ºå¼€å‘ç‰ˆæœ¬ï¼š
- åŒ…å« `sourceMappingURL`ï¼ˆsource mapï¼?
- æ–‡ä»¶ä¿®æ”¹æ—¶é—´åœ¨æœ€è¿?1 å°æ—¶å†?
- æ–‡ä»¶å¤§å°è¾ƒå¤§ï¼ˆæœªå‹ç¼©ï¼?

---

## äºŒã€æŠ€æœ¯æ¶æ?

### 2.1 ç³»ç»Ÿæ¶æ„å›?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?             Auto Reload Plugin                     â”?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”? æ’ä»¶ç”Ÿå‘½å‘¨æœŸ                                         â”?
â”? - onload()    åˆå§‹åŒ–ã€åŠ è½½è®¾ç½®ã€å¯åŠ¨ç›‘æ?             â”?
â”? - onunload()  æ¸…ç†å®šæ—¶å™¨ã€ä¿å­˜çŠ¶æ€?                  â”?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”? è®¾ç½®ç®¡ç†æ¨¡å—                                         â”?
â”? - loadSettings()     åŠ è½½é…ç½®                       â”?
â”? - saveSettings()     ä¿å­˜é…ç½®                       â”?
â”? - DEFAULT_SETTINGS   é»˜è®¤é…ç½®                       â”?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”? ç›‘æ§æ¨¡å¼åˆ‡æ¢                                         â”?
â”? - è‡ªåŠ¨æ¨¡å¼: updateWatchListAuto()                   â”?
â”? - æ™ºèƒ½æ¨¡å¼: identifyDevPlugins()                    â”?
â”? - æ‰‹åŠ¨æ¨¡å¼: ä»?settings.watchedPlugins è¯»å–         â”?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”? æ ¸å¿ƒç›‘æ§æ¨¡å—                                         â”?
â”? - startWatching()        å¯åŠ¨å®šæ—¶å™?                â”?
â”? - checkAndReload()       æ£€æŸ¥å¹¶é‡è½½æ’ä»¶              â”?
â”? - updateLastModified()   æ›´æ–°æ—¶é—´æˆ³ç¼“å­?            â”?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”? è®¾ç½®ç•Œé¢æ¨¡å— (AutoReloadSettingTab)                 â”?
â”? - display()              æ¸²æŸ“è®¾ç½®ç•Œé¢                â”?
â”? - æ’ä»¶åˆ—è¡¨æ¸²æŸ“                                       â”?
â”? - å¿«æ·æ“ä½œæŒ‰é’®                                       â”?
â”? - å‚æ•°é…ç½®é¡?                                        â”?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
         â†?                   â†?                   â†?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?Obsidian API â”? â”?File System      â”? â”?User Settingsâ”?
â”?- plugins    â”? â”?- stat()         â”? â”?- data.json  â”?
â”?- vault      â”? â”?- read()         â”? â”?             â”?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
```

### 2.2 æ•°æ®æµè®¾è®?

```
[ç”¨æˆ·æ“ä½œ/å®šæ—¶å™¨è§¦å‘]
    â†?
[æ ¹æ®ç›‘æ§æ¨¡å¼è·å–æ’ä»¶åˆ—è¡¨]
    â”œâ”€ è‡ªåŠ¨æ¨¡å¼ â†?è·å–æ‰€æœ‰å·²å¯ç”¨æ’ä»¶
    â”œâ”€ æ™ºèƒ½æ¨¡å¼ â†?è¯†åˆ«åŒ…å« source map çš„æ’ä»?
    â””â”€ æ‰‹åŠ¨æ¨¡å¼ â†?ä»é…ç½®è¯»å–é€‰ä¸­çš„æ’ä»?
    â†?
[éå†æ’ä»¶åˆ—è¡¨]
    â†?
[è¯»å– main.js æ–‡ä»¶çŠ¶æ€] â†?vault.adapter.stat()
    â†?
[è·å–ä¿®æ”¹æ—¶é—´ mtime]
    â†?
[å¯¹æ¯”ç¼“å­˜çš„æ—¶é—´æˆ³]
    â†?
[mtime > lastModified?]
    â†?æ˜?
[ç¦ç”¨æ’ä»¶] â†?plugins.disablePlugin()
    â†?
[ç­‰å¾… 100ms]
    â†?
[å¯ç”¨æ’ä»¶] â†?plugins.enablePlugin()
    â†?
[æ›´æ–°æ—¶é—´æˆ³ç¼“å­˜]
    â†?
[æ˜¾ç¤ºé€šçŸ¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰]
    â†?
[è®°å½•æ—¥å¿—]
```

### 2.3 é…ç½®æ•°æ®ç»“æ„

```javascript
interface AutoReloadSettings {
  // ç›‘æ§æ¨¡å¼: 'auto' | 'smart' | 'manual'
  mode: string;
  
  // æ‰‹åŠ¨æ¨¡å¼ä¸‹é€‰ä¸­çš„æ’ä»¶åˆ—è¡?
  watchedPlugins: string[];
  
  // æ£€æŸ¥é—´éš”ï¼ˆæ¯«ç§’ï¼?
  checkInterval: number;
  
  // æ˜¯å¦æ˜¾ç¤ºé‡è½½é€šçŸ¥
  showNotification: boolean;
  
  // æ˜¯å¦åœ¨å¯åŠ¨æ—¶æ˜¾ç¤ºé€šçŸ¥
  showStartupNotification: boolean;
  
  // æ™ºèƒ½æ¨¡å¼çš„æ£€æµ‹é˜ˆå€¼ï¼ˆå°æ—¶ï¼?
  smartModeThreshold: number;
}
```

---

## ä¸‰ã€æ ¸å¿ƒä»£ç å®ç?

### 3.1 manifest.json - æ’ä»¶æ¸…å•

```json
{
  "id": "auto-reload",
  "name": "Auto Reload",
  "version": "2.0.0",
  "minAppVersion": "0.15.0",
  "description": "æ™ºèƒ½è‡ªåŠ¨é‡è½½å¼€å‘ä¸­çš„æ’ä»¶ï¼Œæ”¯æŒè‡ªåŠ¨è¯†åˆ«ã€å¯è§†åŒ–é…ç½®å’Œçµæ´»åˆ‡æ?,
  "author": "LINYF510",
  "authorUrl": "https://github.com/LINYF510",
  "isDesktopOnly": false
}
```

### 3.2 main.js - å®Œæ•´å®ç°

```javascript
const { Plugin, Notice, PluginSettingTab, Setting } = require('obsidian');

// ========== é»˜è®¤é…ç½® ==========
const DEFAULT_SETTINGS = {
  mode: 'smart',                    // é»˜è®¤æ™ºèƒ½æ¨¡å¼
  watchedPlugins: [],               // æ‰‹åŠ¨æ¨¡å¼çš„æ’ä»¶åˆ—è¡?
  checkInterval: 1000,              // æ£€æŸ¥é—´éš?1 ç§?
  showNotification: true,           // æ˜¾ç¤ºé‡è½½é€šçŸ¥
  showStartupNotification: true,    // æ˜¾ç¤ºå¯åŠ¨é€šçŸ¥
  smartModeThreshold: 24            // æ™ºèƒ½æ¨¡å¼é˜ˆå€¼ï¼ˆ24å°æ—¶å†…ä¿®æ”¹çš„æ–‡ä»¶ï¼?
};

class AutoReloadPlugin extends Plugin {
  
  // ========== æ’ä»¶ç”Ÿå‘½å‘¨æœŸ ==========
  
  async onload() {
    console.log('ğŸš€ Auto Reload æ’ä»¶å¯åŠ¨ - ' + new Date().toLocaleTimeString());
    
    // åŠ è½½è®¾ç½®
    await this.loadSettings();
    
    // å­˜å‚¨æ¯ä¸ªæ’ä»¶çš„æœ€åä¿®æ”¹æ—¶é—?
    this.lastModifiedTimes = {};
    
    // æ ¹æ®æ¨¡å¼åˆå§‹åŒ–ç›‘æ§åˆ—è¡?
    await this.updateWatchList();
    
    // å¯åŠ¨ç›‘æ§
    this.startWatching();
    
    // æ·»åŠ è®¾ç½®é¡µé¢
    this.addSettingTab(new AutoReloadSettingTab(this.app, this));
    
    // æ·»åŠ å‘½ä»¤
    this.addCommands();
    
    // å¯åŠ¨é€šçŸ¥
    if (this.settings.showStartupNotification) {
      const modeText = {
        'auto': 'è‡ªåŠ¨æ¨¡å¼ï¼ˆæ‰€æœ‰æ’ä»¶ï¼‰',
        'smart': 'æ™ºèƒ½æ¨¡å¼ï¼ˆå¼€å‘ä¸­çš„æ’ä»¶ï¼‰',
        'manual': 'æ‰‹åŠ¨æ¨¡å¼'
      };
      new Notice(`âœ?Auto Reload å·²å¯åŠ?- ${modeText[this.settings.mode]}`);
    }
    
    console.log(`ğŸ“‹ ç›‘æ§æ¨¡å¼: ${this.settings.mode}`);
    console.log(`ğŸ“‹ ç›‘æ§çš„æ’ä»?(${this.watchedPlugins.length}):`, this.watchedPlugins);
  }
  
  onunload() {
    if (this.intervalId) {
      clearInterval(this.intervalId);
    }
    console.log('ğŸ‘‹ Auto Reload æ’ä»¶å·²å¸è½?- ' + new Date().toLocaleTimeString());
  }
  
  // ========== è®¾ç½®ç®¡ç† ==========
  
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  
  async saveSettings() {
    await this.saveData(this.settings);
  }
  
  // ========== ç›‘æ§åˆ—è¡¨ç®¡ç† ==========
  
  /**
   * æ ¹æ®å½“å‰æ¨¡å¼æ›´æ–°ç›‘æ§åˆ—è¡¨
   */
  async updateWatchList() {
    switch (this.settings.mode) {
      case 'auto':
        this.watchedPlugins = await this.getAutoModePlugins();
        break;
      case 'smart':
        this.watchedPlugins = await this.identifyDevPlugins();
        break;
      case 'manual':
        this.watchedPlugins = this.settings.watchedPlugins;
        break;
      default:
        this.watchedPlugins = [];
    }
    
    // åˆå§‹åŒ–æ‰€æœ‰æ’ä»¶çš„ä¿®æ”¹æ—¶é—´
    for (const pluginId of this.watchedPlugins) {
      await this.updateLastModified(pluginId);
    }
    
    console.log(`ğŸ“‹ [${this.settings.mode}] ç›‘æ§åˆ—è¡¨å·²æ›´æ–?(${this.watchedPlugins.length}):`, 
                this.watchedPlugins);
  }
  
  /**
   * è‡ªåŠ¨æ¨¡å¼ï¼šè·å–æ‰€æœ‰å·²å¯ç”¨çš„æ’ä»¶ï¼ˆæ’é™¤è‡ªå·±ï¼?
   */
  async getAutoModePlugins() {
    const enabledPlugins = Array.from(this.app.plugins.enabledPlugins);
    return enabledPlugins.filter(id => id !== 'auto-reload');
  }
  
  /**
   * æ™ºèƒ½æ¨¡å¼ï¼šè‡ªåŠ¨è¯†åˆ«å¼€å‘ä¸­çš„æ’ä»?
   * æ£€æµ‹ç‰¹å¾ï¼š
   * 1. åŒ…å« sourceMappingURLï¼ˆæœ‰ source mapï¼?
   * 2. æ–‡ä»¶åœ¨é˜ˆå€¼æ—¶é—´å†…è¢«ä¿®æ”¹è¿‡
   * 3. æ–‡ä»¶å¤§å°è¾ƒå¤§ï¼ˆæœªå‹ç¼©ï¼?
   */
  async identifyDevPlugins() {
    const enabledPlugins = Array.from(this.app.plugins.enabledPlugins);
    const devPlugins = [];
    const now = Date.now();
    const thresholdMs = this.settings.smartModeThreshold * 60 * 60 * 1000; // è½¬æ¢ä¸ºæ¯«ç§?
    
    for (const pluginId of enabledPlugins) {
      if (pluginId === 'auto-reload') continue;
      
      try {
        const mainPath = `${this.app.vault.adapter.basePath}/.obsidian/plugins/${pluginId}/main.js`;
        
        // æ£€æŸ¥æ–‡ä»¶çŠ¶æ€?
        const stats = await this.app.vault.adapter.stat(mainPath);
        if (!stats) continue;
        
        let score = 0;  // å¼€å‘ç‰¹å¾è¯„åˆ?
        
        // ç‰¹å¾ 1: æœ€è¿‘ä¿®æ”¹è¿‡ï¼ˆæƒé‡ï¼š3åˆ†ï¼‰
        const hoursSinceModified = (now - stats.mtime) / (1000 * 60 * 60);
        if (hoursSinceModified < this.settings.smartModeThreshold) {
          score += 3;
          console.log(`  ğŸ” [${pluginId}] æœ€è¿‘ä¿®æ”? ${hoursSinceModified.toFixed(1)} å°æ—¶å‰?(+3åˆ?`);
        }
        
        // ç‰¹å¾ 2: åŒ…å« source mapï¼ˆæƒé‡ï¼š5åˆ†ï¼‰
        const content = await this.app.vault.adapter.read(mainPath);
        if (content.includes('sourceMappingURL') || content.includes('sourceMapping')) {
          score += 5;
          console.log(`  ğŸ” [${pluginId}] åŒ…å« source map (+5åˆ?`);
        }
        
        // ç‰¹å¾ 3: æ–‡ä»¶è¾ƒå¤§ï¼ˆæœªå‹ç¼©ï¼Œæƒé‡ï¼š2åˆ†ï¼‰
        // ç”Ÿäº§ç‰ˆæœ¬é€šå¸¸ä¼šå‹ç¼©ï¼Œæ–‡ä»¶è¾ƒå°
        if (stats.size > 50000) {  // å¤§äº 50KB
          score += 2;
          console.log(`  ğŸ” [${pluginId}] æ–‡ä»¶è¾ƒå¤§: ${(stats.size / 1024).toFixed(1)}KB (+2åˆ?`);
        }
        
        // è¯„åˆ†é˜ˆå€¼ï¼š>=5åˆ†è®¤ä¸ºæ˜¯å¼€å‘ç‰ˆæœ?
        if (score >= 5) {
          devPlugins.push(pluginId);
          console.log(`  âœ?[${pluginId}] è¯†åˆ«ä¸ºå¼€å‘æ’ä»?(æ€»åˆ†: ${score})`);
        }
        
      } catch (e) {
        // å¿½ç•¥è¯»å–å¤±è´¥çš„æ’ä»?
      }
    }
    
    console.log(`ğŸ§  æ™ºèƒ½è¯†åˆ«å®Œæˆï¼Œå‘ç?${devPlugins.length} ä¸ªå¼€å‘ä¸­çš„æ’ä»¶`);
    return devPlugins;
  }
  
  /**
   * æ›´æ–°æŒ‡å®šæ’ä»¶çš„æœ€åä¿®æ”¹æ—¶é—?
   */
  async updateLastModified(pluginId) {
    try {
      const pluginPath = `${this.app.vault.adapter.basePath}/.obsidian/plugins/${pluginId}/main.js`;
      const stats = await this.app.vault.adapter.stat(pluginPath);
      if (stats) {
        this.lastModifiedTimes[pluginId] = stats.mtime;
      }
    } catch (e) {
      console.error(`â?æ— æ³•è¯»å–æ’ä»¶ ${pluginId}:`, e.message);
    }
  }
  
  // ========== ç›‘æ§æ ¸å¿ƒé€»è¾‘ ==========
  
  /**
   * å¯åŠ¨æ–‡ä»¶ç›‘æ§å®šæ—¶å™?
   */
  startWatching() {
    // æ¸…é™¤æ—§çš„å®šæ—¶å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼?
    if (this.intervalId) {
      clearInterval(this.intervalId);
    }
    
    this.intervalId = setInterval(async () => {
      // åœ¨æ™ºèƒ½æ¨¡å¼ä¸‹ï¼Œå®šæœŸé‡æ–°è¯†åˆ«ï¼ˆæ¯?100 æ¬¡æ£€æŸ¥ï¼Œçº?100 ç§’ï¼‰
      if (this.settings.mode === 'smart' && Math.random() < 0.01) {
        console.log('ğŸ”„ æ™ºèƒ½æ¨¡å¼ï¼šé‡æ–°è¯†åˆ«å¼€å‘æ’ä»?..');
        await this.updateWatchList();
      }
      
      // æ£€æŸ¥æ‰€æœ‰ç›‘æ§çš„æ’ä»¶
      for (const pluginId of this.watchedPlugins) {
        await this.checkAndReload(pluginId);
      }
    }, this.settings.checkInterval);
    
    console.log(`â±ï¸  ç›‘æ§å·²å¯åŠ¨ï¼Œæ£€æŸ¥é—´éš? ${this.settings.checkInterval}ms`);
  }
  
  /**
   * æ£€æŸ¥æ’ä»¶æ–‡ä»¶æ˜¯å¦æ›´æ–°ï¼Œå¦‚æœæ›´æ–°åˆ™é‡æ–°åŠ è½?
   */
  async checkAndReload(pluginId) {
    try {
      const pluginPath = `${this.app.vault.adapter.basePath}/.obsidian/plugins/${pluginId}/main.js`;
      const stats = await this.app.vault.adapter.stat(pluginPath);
      
      if (!stats) return;
      
      // æ£€æŸ¥ä¿®æ”¹æ—¶é—?
      const lastMtime = this.lastModifiedTimes[pluginId] || 0;
      if (stats.mtime > lastMtime) {
        const oldTime = new Date(lastMtime).toLocaleTimeString();
        const newTime = new Date(stats.mtime).toLocaleTimeString();
        
        console.log(`ğŸ”„ æ£€æµ‹åˆ°æ’ä»¶ ${pluginId} æ›´æ–°`);
        console.log(`   æ—§æ—¶é—? ${oldTime}`);
        console.log(`   æ–°æ—¶é—? ${newTime}`);
        
        // ========== æ ¸å¿ƒé‡è½½é€»è¾‘ ==========
        
        // 1. ç¦ç”¨æ’ä»¶
        await this.app.plugins.disablePlugin(pluginId);
        
        // 2. çŸ­æš‚å»¶è¿Ÿï¼Œç¡®ä¿å®Œå…¨å¸è½?
        await this.sleep(100);
        
        // 3. é‡æ–°å¯ç”¨æ’ä»¶
        await this.app.plugins.enablePlugin(pluginId);
        
        // 4. æ›´æ–°ç¼“å­˜çš„ä¿®æ”¹æ—¶é—?
        this.lastModifiedTimes[pluginId] = stats.mtime;
        
        // 5. æ—¥å¿—å’Œé€šçŸ¥
        console.log(`âœ?æ’ä»¶ ${pluginId} å·²é‡æ–°åŠ è½½`);
        
        if (this.settings.showNotification) {
          const manifest = this.app.plugins.manifests[pluginId];
          const pluginName = manifest?.name || pluginId;
          new Notice(`âœ?${pluginName} å·²è‡ªåŠ¨é‡æ–°åŠ è½½`);
        }
      }
    } catch (e) {
      console.error(`â?æ£€æŸ¥æ’ä»?${pluginId} å¤±è´¥:`, e.message);
    }
  }
  
  /**
   * è¾…åŠ©æ–¹æ³•ï¼šå»¶è¿Ÿæ‰§è¡?
   */
  sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  
  // ========== å‘½ä»¤æ³¨å†Œ ==========
  
  addCommands() {
    // å‘½ä»¤ï¼šåˆ·æ–°ç›‘æ§åˆ—è¡?
    this.addCommand({
      id: 'refresh-watch-list',
      name: 'åˆ·æ–°ç›‘æ§åˆ—è¡¨',
      callback: async () => {
        await this.updateWatchList();
        this.startWatching();
        new Notice(`âœ?ç›‘æ§åˆ—è¡¨å·²åˆ·æ–?(${this.watchedPlugins.length} ä¸ªæ’ä»?`);
      }
    });
    
    // å‘½ä»¤ï¼šåˆ‡æ¢åˆ°è‡ªåŠ¨æ¨¡å¼
    this.addCommand({
      id: 'switch-to-auto-mode',
      name: 'åˆ‡æ¢åˆ°è‡ªåŠ¨æ¨¡å¼?,
      callback: async () => {
        this.settings.mode = 'auto';
        await this.saveSettings();
        await this.updateWatchList();
        this.startWatching();
        new Notice('âœ?å·²åˆ‡æ¢åˆ°è‡ªåŠ¨æ¨¡å¼ï¼ˆç›‘æ§æ‰€æœ‰å·²å¯ç”¨æ’ä»¶ï¼?);
      }
    });
    
    // å‘½ä»¤ï¼šåˆ‡æ¢åˆ°æ™ºèƒ½æ¨¡å¼
    this.addCommand({
      id: 'switch-to-smart-mode',
      name: 'åˆ‡æ¢åˆ°æ™ºèƒ½æ¨¡å¼?,
      callback: async () => {
        this.settings.mode = 'smart';
        await this.saveSettings();
        await this.updateWatchList();
        this.startWatching();
        new Notice('âœ?å·²åˆ‡æ¢åˆ°æ™ºèƒ½æ¨¡å¼ï¼ˆè‡ªåŠ¨è¯†åˆ«å¼€å‘æ’ä»¶ï¼‰');
      }
    });
    
    // å‘½ä»¤ï¼šåˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼
    this.addCommand({
      id: 'switch-to-manual-mode',
      name: 'åˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼?,
      callback: async () => {
        this.settings.mode = 'manual';
        await this.saveSettings();
        await this.updateWatchList();
        this.startWatching();
        new Notice('âœ?å·²åˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼ï¼ˆåœ¨è®¾ç½®ä¸­é€‰æ‹©æ’ä»¶ï¼?);
      }
    });
    
    // å‘½ä»¤ï¼šæ‰‹åŠ¨é‡è½½æŒ‡å®šæ’ä»?
    this.addCommand({
      id: 'manual-reload-plugin',
      name: 'æ‰‹åŠ¨é‡è½½å½“å‰å¼€å‘çš„æ’ä»¶',
      callback: async () => {
        if (this.watchedPlugins.length === 0) {
          new Notice('â?æ²¡æœ‰ç›‘æ§çš„æ’ä»?);
          return;
        }
        
        // é‡è½½ç¬¬ä¸€ä¸ªç›‘æ§çš„æ’ä»¶
        const pluginId = this.watchedPlugins[0];
        await this.app.plugins.disablePlugin(pluginId);
        await this.sleep(100);
        await this.app.plugins.enablePlugin(pluginId);
        new Notice(`âœ?å·²æ‰‹åŠ¨é‡è½?${pluginId}`);
      }
    });
  }
}

// ========== è®¾ç½®é¡µé¢ ==========

class AutoReloadSettingTab extends PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  
  display() {
    const { containerEl } = this;
    containerEl.empty();
    
    containerEl.createEl('h2', { text: 'Auto Reload è®¾ç½®' });
    
    // ========== ç›‘æ§æ¨¡å¼é€‰æ‹© ==========
    containerEl.createEl('h3', { text: 'ç›‘æ§æ¨¡å¼' });
    
    new Setting(containerEl)
      .setName('ç›‘æ§æ¨¡å¼')
      .setDesc('é€‰æ‹©å¦‚ä½•ç¡®å®šè¦ç›‘æ§çš„æ’ä»¶')
      .addDropdown(dropdown => dropdown
        .addOption('auto', 'ğŸ¤– è‡ªåŠ¨æ¨¡å¼ - ç›‘æ§æ‰€æœ‰å·²å¯ç”¨çš„æ’ä»?)
        .addOption('smart', 'ğŸ§  æ™ºèƒ½æ¨¡å¼ - è‡ªåŠ¨è¯†åˆ«å¼€å‘ä¸­çš„æ’ä»¶ï¼ˆæ¨èï¼?)
        .addOption('manual', 'âœ?æ‰‹åŠ¨æ¨¡å¼ - æ‰‹åŠ¨é€‰æ‹©è¦ç›‘æ§çš„æ’ä»¶')
        .setValue(this.plugin.settings.mode)
        .onChange(async (value) => {
          this.plugin.settings.mode = value;
          await this.plugin.saveSettings();
          await this.plugin.updateWatchList();
          this.plugin.startWatching();
          this.display();  // åˆ·æ–°ç•Œé¢
          
          const modeText = {
            'auto': 'è‡ªåŠ¨æ¨¡å¼',
            'smart': 'æ™ºèƒ½æ¨¡å¼',
            'manual': 'æ‰‹åŠ¨æ¨¡å¼'
          };
          new Notice(`âœ?å·²åˆ‡æ¢åˆ°${modeText[value]}`);
        }));
    
    // æ¨¡å¼è¯´æ˜
    const modeDesc = containerEl.createDiv({ cls: 'setting-item-description' });
    if (this.plugin.settings.mode === 'auto') {
      modeDesc.innerHTML = `
        <p>ğŸ¤– <strong>è‡ªåŠ¨æ¨¡å¼</strong>ï¼šç›‘æ§æ‰€æœ‰å·²å¯ç”¨çš„æ’ä»¶ï¼ˆé™¤äº† Auto Reload è‡ªå·±ï¼‰ã€?/p>
        <p>é€‚åˆï¼šå¿«é€Ÿå¼€å§‹ï¼Œä¸æƒ³é…ç½®ã€?/p>
      `;
    } else if (this.plugin.settings.mode === 'smart') {
      modeDesc.innerHTML = `
        <p>ğŸ§  <strong>æ™ºèƒ½æ¨¡å¼</strong>ï¼šè‡ªåŠ¨è¯†åˆ«å¼€å‘ä¸­çš„æ’ä»¶ï¼Œé€šè¿‡ä»¥ä¸‹ç‰¹å¾åˆ¤æ–­ï¼?/p>
        <ul>
          <li>âœ?åŒ…å« source mapï¼ˆsourceMappingURLï¼?/li>
          <li>âœ?æ–‡ä»¶åœ¨æœ€è¿?${this.plugin.settings.smartModeThreshold} å°æ—¶å†…è¢«ä¿®æ”¹</li>
          <li>âœ?æ–‡ä»¶è¾ƒå¤§ï¼ˆæœªå‹ç¼©ï¼?/li>
        </ul>
        <p>é€‚åˆï¼šå¤§å¤šæ•°å¼€å‘åœºæ™¯ï¼ˆæ¨èï¼‰ã€?/p>
      `;
    } else {
      modeDesc.innerHTML = `
        <p>âœ?<strong>æ‰‹åŠ¨æ¨¡å¼</strong>ï¼šåœ¨ä¸‹æ–¹åˆ—è¡¨ä¸­æ‰‹åŠ¨å‹¾é€‰è¦ç›‘æ§çš„æ’ä»¶ã€?/p>
        <p>é€‚åˆï¼šéœ€è¦ç²¾ç¡®æ§åˆ¶çš„ä¸“ä¸šå¼€å‘è€…ã€?/p>
      `;
    }
    
    // ========== æ™ºèƒ½æ¨¡å¼è®¾ç½® ==========
    if (this.plugin.settings.mode === 'smart') {
      new Setting(containerEl)
        .setName('æ™ºèƒ½è¯†åˆ«é˜ˆå€?)
        .setDesc('æ–‡ä»¶åœ¨å¤šå°‘å°æ—¶å†…ä¿®æ”¹è¿‡ï¼Œæ‰è®¤ä¸ºæ˜¯å¼€å‘ç‰ˆæœ?)
        .addText(text => text
          .setPlaceholder('24')
          .setValue(String(this.plugin.settings.smartModeThreshold))
          .onChange(async (value) => {
            const threshold = parseInt(value);
            if (!isNaN(threshold) && threshold > 0) {
              this.plugin.settings.smartModeThreshold = threshold;
              await this.plugin.saveSettings();
            }
          }))
        .addButton(button => button
          .setButtonText('é‡æ–°è¯†åˆ«')
          .onClick(async () => {
            await this.plugin.updateWatchList();
            this.plugin.startWatching();
            this.display();
            new Notice(`âœ?é‡æ–°è¯†åˆ«å®Œæˆï¼Œå‘ç?${this.plugin.watchedPlugins.length} ä¸ªå¼€å‘æ’ä»¶`);
          }));
    }
    
    // ========== æ’ä»¶åˆ—è¡¨ï¼ˆæ‰‹åŠ¨æ¨¡å¼ï¼‰ ==========
    if (this.plugin.settings.mode === 'manual') {
      containerEl.createEl('h3', { text: 'é€‰æ‹©è¦ç›‘æ§çš„æ’ä»¶' });
      
      // å¿«é€Ÿæ“ä½œæŒ‰é’?
      const buttonContainer = containerEl.createDiv({ cls: 'setting-item' });
      
      new Setting(buttonContainer)
        .setName('å¿«é€Ÿæ“ä½?)
        .addButton(button => button
          .setButtonText('å…¨é€‰å·²å¯ç”¨')
          .onClick(async () => {
            const enabledPlugins = Array.from(this.app.plugins.enabledPlugins);
            this.plugin.settings.watchedPlugins = enabledPlugins.filter(id => id !== 'auto-reload');
            await this.plugin.saveSettings();
            await this.plugin.updateWatchList();
            this.plugin.startWatching();
            this.display();
            new Notice('âœ?å·²æ·»åŠ æ‰€æœ‰å·²å¯ç”¨çš„æ’ä»?);
          }))
        .addButton(button => button
          .setButtonText('æ¸…ç©ºå…¨éƒ¨')
          .setWarning()
          .onClick(async () => {
            this.plugin.settings.watchedPlugins = [];
            await this.plugin.saveSettings();
            await this.plugin.updateWatchList();
            this.plugin.startWatching();
            this.display();
            new Notice('âœ?å·²æ¸…ç©ºç›‘æ§åˆ—è¡?);
          }))
        .addButton(button => button
          .setButtonText('æ™ºèƒ½è¯†åˆ«')
          .onClick(async () => {
            const devPlugins = await this.plugin.identifyDevPlugins();
            this.plugin.settings.watchedPlugins = devPlugins;
            await this.plugin.saveSettings();
            await this.plugin.updateWatchList();
            this.plugin.startWatching();
            this.display();
            new Notice(`âœ?æ™ºèƒ½è¯†åˆ«å®Œæˆï¼Œå‘ç?${devPlugins.length} ä¸ªå¼€å‘æ’ä»¶`);
          }));
      
      // æ’ä»¶åˆ—è¡¨
      const allPlugins = Object.keys(this.app.plugins.manifests);
      const enabledPlugins = Array.from(this.app.plugins.enabledPlugins);
      
      allPlugins
        .filter(id => id !== 'auto-reload')
        .sort()
        .forEach(pluginId => {
          const manifest = this.app.plugins.manifests[pluginId];
          const isEnabled = enabledPlugins.includes(pluginId);
          const isWatched = this.plugin.settings.watchedPlugins.includes(pluginId);
          
          new Setting(containerEl)
            .setName(manifest.name)
            .setDesc(`ID: ${pluginId}${isEnabled ? '' : ' (æœªå¯ç”?'}`)
            .addToggle(toggle => toggle
              .setValue(isWatched)
              .onChange(async (value) => {
                if (value) {
                  if (!this.plugin.settings.watchedPlugins.includes(pluginId)) {
                    this.plugin.settings.watchedPlugins.push(pluginId);
                    await this.plugin.updateLastModified(pluginId);
                  }
                } else {
                  this.plugin.settings.watchedPlugins = 
                    this.plugin.settings.watchedPlugins.filter(id => id !== pluginId);
                }
                
                await this.plugin.saveSettings();
                await this.plugin.updateWatchList();
                this.plugin.startWatching();
              }));
        });
    }
    
    // ========== å…¶ä»–è®¾ç½® ==========
    containerEl.createEl('h3', { text: 'å…¶ä»–è®¾ç½®' });
    
    // æ£€æŸ¥é—´éš?
    new Setting(containerEl)
      .setName('æ£€æŸ¥é—´éš?)
      .setDesc('å¤šä¹…æ£€æŸ¥ä¸€æ¬¡æ–‡ä»¶æ›´æ–°ï¼ˆæ¯«ç§’ï¼‰ã€‚æ¨è?1000ï¼?ç§’ï¼‰ã€?)
      .addText(text => text
        .setPlaceholder('1000')
        .setValue(String(this.plugin.settings.checkInterval))
        .onChange(async (value) => {
          const interval = parseInt(value);
          if (!isNaN(interval) && interval >= 100) {
            this.plugin.settings.checkInterval = interval;
            await this.plugin.saveSettings();
            this.plugin.startWatching();
            new Notice('âœ?æ£€æŸ¥é—´éš”å·²æ›´æ–°');
          }
        }));
    
    // æ˜¾ç¤ºé‡è½½é€šçŸ¥
    new Setting(containerEl)
      .setName('æ˜¾ç¤ºé‡è½½é€šçŸ¥')
      .setDesc('æ’ä»¶é‡æ–°åŠ è½½æ—¶æ˜¯å¦æ˜¾ç¤ºé€šçŸ¥')
      .addToggle(toggle => toggle
        .setValue(this.plugin.settings.showNotification)
        .onChange(async (value) => {
          this.plugin.settings.showNotification = value;
          await this.plugin.saveSettings();
        }));
    
    // æ˜¾ç¤ºå¯åŠ¨é€šçŸ¥
    new Setting(containerEl)
      .setName('æ˜¾ç¤ºå¯åŠ¨é€šçŸ¥')
      .setDesc('Auto Reload å¯åŠ¨æ—¶æ˜¯å¦æ˜¾ç¤ºé€šçŸ¥')
      .addToggle(toggle => toggle
        .setValue(this.plugin.settings.showStartupNotification)
        .onChange(async (value) => {
          this.plugin.settings.showStartupNotification = value;
          await this.plugin.saveSettings();
        }));
    
    // ========== å½“å‰çŠ¶æ€?==========
    containerEl.createEl('h3', { text: 'å½“å‰çŠ¶æ€? });
    
    const statusDiv = containerEl.createDiv({ cls: 'setting-item-description' });
    const modeText = {
      'auto': 'è‡ªåŠ¨æ¨¡å¼',
      'smart': 'æ™ºèƒ½æ¨¡å¼',
      'manual': 'æ‰‹åŠ¨æ¨¡å¼'
    };
    
    statusDiv.innerHTML = `
      <p><strong>ç›‘æ§æ¨¡å¼</strong>: ${modeText[this.plugin.settings.mode]}</p>
      <p><strong>ç›‘æ§æ’ä»¶æ•°é‡</strong>: ${this.plugin.watchedPlugins.length} ä¸?/p>
      <p><strong>æ£€æŸ¥é—´éš?/strong>: ${this.plugin.settings.checkInterval}ms</p>
    `;
    
    if (this.plugin.watchedPlugins.length > 0) {
      statusDiv.createEl('p').innerHTML = '<strong>æ­£åœ¨ç›‘æ§çš„æ’ä»?</strong>';
      const list = statusDiv.createEl('ul');
      this.plugin.watchedPlugins.forEach(id => {
        const manifest = this.app.plugins.manifests[id];
        list.createEl('li', { text: manifest?.name || id });
      });
    }
    
    // ========== è°ƒè¯•ä¿¡æ¯ ==========
    const debugBtn = new Setting(containerEl)
      .setName('è°ƒè¯•ä¿¡æ¯')
      .setDesc('åœ¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†çš„ç›‘æ§ä¿¡æ?)
      .addButton(button => button
        .setButtonText('æ‰“å¼€æ§åˆ¶å?)
        .onClick(() => {
          // è§¦å‘æ‰“å¼€å¼€å‘è€…å·¥å…·çš„æç¤º
          new Notice('è¯·æŒ‰ Cmd+Option+I (Mac) æˆ?Ctrl+Shift+I (Windows) æ‰“å¼€æ§åˆ¶å?);
          console.log('========== Auto Reload è°ƒè¯•ä¿¡æ¯ ==========');
          console.log('ç›‘æ§æ¨¡å¼:', this.plugin.settings.mode);
          console.log('ç›‘æ§æ’ä»¶:', this.plugin.watchedPlugins);
          console.log('æœ€åä¿®æ”¹æ—¶é—?', this.plugin.lastModifiedTimes);
          console.log('========================================');
        }));
  }
}

module.exports = AutoReloadPlugin;
```

---

## å››ã€æ™ºèƒ½è¯†åˆ«ç®—æ³•è¯¦è§?

### 4.1 è¯†åˆ«é€»è¾‘

```javascript
/**
 * æ™ºèƒ½è¯†åˆ«è¯„åˆ†ç³»ç»Ÿ
 * 
 * é€šè¿‡å¤šä¸ªç‰¹å¾ç»¼åˆåˆ¤æ–­æ’ä»¶æ˜¯å¦ä¸ºå¼€å‘ç‰ˆæœ?
 */

// ç‰¹å¾æƒé‡è¡?
const FEATURE_WEIGHTS = {
  hasSourceMap: 5,      // åŒ…å« source mapï¼ˆå¼ºç‰¹å¾ï¼?
  recentModified: 3,    // æœ€è¿‘ä¿®æ”¹è¿‡ï¼ˆä¸­ç­‰ç‰¹å¾ï¼‰
  largeFile: 2          // æ–‡ä»¶è¾ƒå¤§ï¼ˆå¼±ç‰¹å¾ï¼?
};

// åˆ¤æ–­é˜ˆå€?
const DEV_PLUGIN_THRESHOLD = 5;  // æ€»åˆ† >= 5 è®¤ä¸ºæ˜¯å¼€å‘ç‰ˆæœ?
```

### 4.2 ç‰¹å¾æ£€æµ?

#### ç‰¹å¾ 1ï¼šSource Map æ£€æµ?

```javascript
// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åŒ…å?source map
const content = await this.app.vault.adapter.read(mainPath);
const hasSourceMap = content.includes('sourceMappingURL') || 
                     content.includes('sourceMapping');

if (hasSourceMap) {
  score += 5;
  console.log(`  âœ?[${pluginId}] åŒ…å« source map (+5åˆ?`);
}
```

**åŸç†**ï¼?
- å¼€å‘ç‰ˆæœ¬é€šå¸¸åŒ…å« source map ç”¨äºè°ƒè¯•
- ç”Ÿäº§ç‰ˆæœ¬ä¼šç§»é™?source map ä»¥å‡å°æ–‡ä»¶å¤§å°?
- æ£€æµ‹å­—ç¬¦ä¸²ï¼š`//# sourceMappingURL=main.js.map`

#### ç‰¹å¾ 2ï¼šæ–‡ä»¶ä¿®æ”¹æ—¶é—´æ£€æµ?

```javascript
// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨æœ€è¿?N å°æ—¶å†…è¢«ä¿®æ”¹
const now = Date.now();
const hoursSinceModified = (now - stats.mtime) / (1000 * 60 * 60);

if (hoursSinceModified < this.settings.smartModeThreshold) {
  score += 3;
  console.log(`  âœ?[${pluginId}] æœ€è¿‘ä¿®æ”? ${hoursSinceModified.toFixed(1)} å°æ—¶å‰?(+3åˆ?`);
}
```

**åŸç†**ï¼?
- æ­£åœ¨å¼€å‘çš„æ’ä»¶ä¼šé¢‘ç¹ä¿®æ”?
- å·²å‘å¸ƒçš„æ’ä»¶å¾ˆå°‘ä¿®æ”¹
- é»˜è®¤é˜ˆå€¼ï¼š24 å°æ—¶

#### ç‰¹å¾ 3ï¼šæ–‡ä»¶å¤§å°æ£€æµ?

```javascript
// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¾ƒå¤§ï¼ˆæœªå‹ç¼©ï¼‰
if (stats.size > 50000) {  // å¤§äº 50KB
  score += 2;
  console.log(`  âœ?[${pluginId}] æ–‡ä»¶è¾ƒå¤§: ${(stats.size / 1024).toFixed(1)}KB (+2åˆ?`);
}
```

**åŸç†**ï¼?
- å¼€å‘ç‰ˆæœ¬é€šå¸¸æœªå‹ç¼©ã€åŒ…å«æ³¨é‡Šå’Œç©ºæ ¼
- ç”Ÿäº§ç‰ˆæœ¬ä¼šå‹ç¼©æ··æ·†ï¼Œæ–‡ä»¶è¾ƒå°
- é˜ˆå€¼ï¼š50KB

### 4.3 è¯„åˆ†ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼šå¼€å‘ä¸­çš„æ’ä»?*

```
my-awesome-plugin
  âœ?åŒ…å« source map (+5åˆ?
  âœ?æœ€è¿‘ä¿®æ”? 0.5 å°æ—¶å‰?(+3åˆ?
  âœ?æ–‡ä»¶è¾ƒå¤§: 128.5KB (+2åˆ?
  ----------------
  æ€»åˆ†: 10 åˆ?â†?è¯†åˆ«ä¸ºå¼€å‘æ’ä»?âœ?
```

**ç¤ºä¾‹ 2ï¼šå·²å‘å¸ƒçš„æ’ä»?*

```
obsidian-git
  â?ä¸åŒ…å?source map (0åˆ?
  â?æœ€è¿‘ä¿®æ”? 72 å°æ—¶å‰?(0åˆ?
  â?æ–‡ä»¶è¾ƒå°: 32.1KB (0åˆ?
  ----------------
  æ€»åˆ†: 0 åˆ?â†?ä¸æ˜¯å¼€å‘æ’ä»?âœ?
```

---

## äº”ã€ç”¨æˆ·ä½¿ç”¨æŒ‡å?

### 5.1 å®‰è£…æ­¥éª¤

#### æ–¹å¼ 1ï¼šæ‰‹åŠ¨å®‰è£?

```bash
# 1. è¿›å…¥ Vault çš„æ’ä»¶ç›®å½?
cd ~/Documents/ä½ çš„Vaultå?.obsidian/plugins/

# 2. åˆ›å»ºæ’ä»¶ç›®å½•
mkdir auto-reload
cd auto-reload

# 3. åˆ›å»º manifest.json å’?main.js
# ï¼ˆå¤åˆ¶ä¸Šé¢ç¬¬ä¸‰ç« çš„ä»£ç ï¼‰

# 4. ä¿®æ”¹æƒé™
chmod 644 manifest.json main.js
```

#### æ–¹å¼ 2ï¼šä» GitHub å®‰è£…

```bash
cd ~/Documents/ä½ çš„Vaultå?.obsidian/plugins/
git clone https://github.com/LINYF510/obsidian-auto-reload.git auto-reload
```

### 5.2 é¦–æ¬¡ä½¿ç”¨

1. **å¯ç”¨æ’ä»¶**ï¼?
   ```
   Obsidian â†?è®¾ç½® â†?ç¬¬ä¸‰æ–¹æ’ä»?â†?å…³é—­å®‰å…¨æ¨¡å¼ â†?å¯ç”¨ Auto Reload
   ```

2. **çœ‹åˆ°å¯åŠ¨é€šçŸ¥**ï¼?
   ```
   âœ?Auto Reload å·²å¯åŠ?- æ™ºèƒ½æ¨¡å¼ï¼ˆå¼€å‘ä¸­çš„æ’ä»¶ï¼‰
   ```

3. **é»˜è®¤é…ç½®**ï¼?
   - ç›‘æ§æ¨¡å¼ï¼šæ™ºèƒ½æ¨¡å¼ï¼ˆè‡ªåŠ¨è¯†åˆ«å¼€å‘æ’ä»¶ï¼‰
   - æ£€æŸ¥é—´éš”ï¼š1000msï¼?ç§’ï¼‰
   - æ˜¾ç¤ºé€šçŸ¥ï¼šå¼€å?

4. **å¼€å§‹å¼€å?*ï¼?
   - ä¿®æ”¹ä½ çš„æ’ä»¶ä»£ç 
   - ä¿å­˜æ–‡ä»¶
   - ç­‰å¾… 1-2 ç§?
   - âœ?æ’ä»¶è‡ªåŠ¨é‡æ–°åŠ è½½

### 5.3 åˆ‡æ¢ç›‘æ§æ¨¡å¼

#### æ–¹å¼ 1ï¼šé€šè¿‡è®¾ç½®é¡µé¢

```
è®¾ç½® â†?Auto Reload â†?ç›‘æ§æ¨¡å¼ â†?é€‰æ‹©æ¨¡å¼
```

#### æ–¹å¼ 2ï¼šé€šè¿‡å‘½ä»¤é¢æ¿

```
Cmd+P (æ‰“å¼€å‘½ä»¤é¢æ¿) â†?è¾“å…¥ "Auto Reload" â†?é€‰æ‹©åˆ‡æ¢å‘½ä»¤
```

å¯ç”¨å‘½ä»¤ï¼?
- `Auto Reload: åˆ‡æ¢åˆ°è‡ªåŠ¨æ¨¡å¼`
- `Auto Reload: åˆ‡æ¢åˆ°æ™ºèƒ½æ¨¡å¼`
- `Auto Reload: åˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼`
- `Auto Reload: åˆ·æ–°ç›‘æ§åˆ—è¡¨`

### 5.4 ä½¿ç”¨åœºæ™¯

#### åœºæ™¯ 1ï¼šå¿«é€Ÿå¼€å§‹ï¼ˆé›¶é…ç½®ï¼‰

```bash
# 1. å®‰è£…å¹¶å¯ç”?Auto Reload
# 2. å¯åŠ¨å¼€å?
npm run dev
# 3. ä¿®æ”¹ä»£ç  â†?è‡ªåŠ¨é‡è½½ âœ?
```

**é»˜è®¤æ™ºèƒ½æ¨¡å¼**ä¼šè‡ªåŠ¨è¯†åˆ«ä½ çš„å¼€å‘æ’ä»¶å¹¶ç›‘æ§ã€?

#### åœºæ™¯ 2ï¼šåŒæ—¶å¼€å‘å¤šä¸ªæ’ä»?

```
è®¾ç½® â†?Auto Reload â†?ç›‘æ§æ¨¡å¼ â†?è‡ªåŠ¨æ¨¡å¼
```

è‡ªåŠ¨ç›‘æ§æ‰€æœ‰å·²å¯ç”¨çš„æ’ä»¶ã€?

#### åœºæ™¯ 3ï¼šç²¾ç¡®æ§åˆ¶ï¼ˆä¸“ä¸šå¼€å‘ï¼‰

```
è®¾ç½® â†?Auto Reload â†?ç›‘æ§æ¨¡å¼ â†?æ‰‹åŠ¨æ¨¡å¼
â†?å‹¾é€‰è¦ç›‘æ§çš„æ’ä»?
```

æ‰‹åŠ¨é€‰æ‹©éœ€è¦ç›‘æ§çš„æ’ä»¶ã€?

### 5.5 è®¾ç½®é¡µé¢æˆªå›¾ï¼ˆæ–‡å­—æè¿°ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?Auto Reload è®¾ç½®                                      â”?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?                                                      â”?
â”?ç›‘æ§æ¨¡å¼                                              â”?
â”?â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?â”?
â”?â”?ç›‘æ§æ¨¡å¼: [ğŸ§  æ™ºèƒ½æ¨¡å¼ â–¼]                         â”?â”?
â”?â”?                                                  â”?â”?
â”?â”?ğŸ§  æ™ºèƒ½æ¨¡å¼ï¼šè‡ªåŠ¨è¯†åˆ«å¼€å‘ä¸­çš„æ’ä»¶ï¼Œé€šè¿‡ä»¥ä¸‹ç‰¹å¾åˆ¤æ–­ï¼?â”?â”?
â”?â”?  âœ?åŒ…å« source mapï¼ˆsourceMappingURLï¼?         â”?â”?
â”?â”?  âœ?æ–‡ä»¶åœ¨æœ€è¿?24 å°æ—¶å†…è¢«ä¿®æ”¹                    â”?â”?
â”?â”?  âœ?æ–‡ä»¶è¾ƒå¤§ï¼ˆæœªå‹ç¼©ï¼?                           â”?â”?
â”?â”?é€‚åˆï¼šå¤§å¤šæ•°å¼€å‘åœºæ™¯ï¼ˆæ¨èï¼‰ã€?                    â”?â”?
â”?â”?                                                  â”?â”?
â”?â”?æ™ºèƒ½è¯†åˆ«é˜ˆå€? [24] å°æ—¶  [é‡æ–°è¯†åˆ«]                â”?â”?
â”?â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?â”?
â”?                                                      â”?
â”?å…¶ä»–è®¾ç½®                                              â”?
â”?â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?â”?
â”?â”?æ£€æŸ¥é—´éš? [1000] æ¯«ç§’                             â”?â”?
â”?â”?â˜?æ˜¾ç¤ºé‡è½½é€šçŸ¥                                    â”?â”?
â”?â”?â˜?æ˜¾ç¤ºå¯åŠ¨é€šçŸ¥                                    â”?â”?
â”?â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?â”?
â”?                                                      â”?
â”?å½“å‰çŠ¶æ€?                                             â”?
â”?â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?â”?
â”?â”?ç›‘æ§æ¨¡å¼: æ™ºèƒ½æ¨¡å¼                                 â”?â”?
â”?â”?ç›‘æ§æ’ä»¶æ•°é‡: 2 ä¸?                                â”?â”?
â”?â”?æ£€æŸ¥é—´éš? 1000ms                                  â”?â”?
â”?â”?                                                  â”?â”?
â”?â”?æ­£åœ¨ç›‘æ§çš„æ’ä»?                                    â”?â”?
â”?â”?  â€?My Awesome Plugin                            â”?â”?
â”?â”?  â€?Test Plugin                                  â”?â”?
â”?â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?â”?
â”?                                                      â”?
â”?è°ƒè¯•ä¿¡æ¯                                              â”?
â”?[æ‰“å¼€æ§åˆ¶å°]                                          â”?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
```

---

## å…­ã€æ€§èƒ½ä¸ä¼˜åŒ?

### 6.1 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€?| è¯´æ˜ |
|------|------|------|
| CPU å ç”¨ | < 0.1% | å®šæ—¶å™¨è½®è¯¢çš„ CPU å¼€é”€ |
| å†…å­˜å ç”¨ | < 2MB | æ’ä»¶è¿è¡Œæ—¶å†…å­?|
| I/O å¼€é”€ | ä½?| åªè°ƒç”?stat()ï¼Œä¸è¯»å–æ–‡ä»¶å†…å®¹ |
| å“åº”å»¶è¿Ÿ | 1-2ç§?| ä»ä¿å­˜åˆ°é‡è½½çš„æ—¶é—?|

### 6.2 ä¼˜åŒ–ç­–ç•¥

#### ä¼˜åŒ– 1ï¼šæ™ºèƒ½æ¨¡å¼çš„ç¼“å­˜

```javascript
// åªåœ¨éœ€è¦æ—¶é‡æ–°è¯†åˆ«ï¼ˆæ¯ 100 æ¬¡æ£€æŸ¥çº¦ 1 æ¬¡ï¼‰
if (this.settings.mode === 'smart' && Math.random() < 0.01) {
  await this.updateWatchList();
}
```

#### ä¼˜åŒ– 2ï¼šè·³è¿‡ä¸å­˜åœ¨çš„æ’ä»?

```javascript
const stats = await this.app.vault.adapter.stat(pluginPath);
if (!stats) return;  // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç›´æ¥è·³è¿‡
```

#### ä¼˜åŒ– 3ï¼šå¼‚æ­¥å¹¶è¡Œæ£€æŸ?

```javascript
// å¯ä»¥æ”¹è¿›ä¸ºå¹¶è¡Œæ£€æŸ¥ï¼ˆå¦‚æœæ’ä»¶å¾ˆå¤šï¼?
await Promise.all(
  this.watchedPlugins.map(id => this.checkAndReload(id))
);
```

### 6.3 èµ„æºå ç”¨å¯¹æ¯”

```
ç›‘æ§ 10 ä¸ªæ’ä»¶çš„èµ„æºå ç”¨ï¼?

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?             â”?1ç§’é—´éš? â”?2ç§’é—´éš? â”?
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?CPU (å¹³å‡)   â”?0.08%    â”?0.04%    â”?
â”?å†…å­˜         â”?1.8 MB   â”?1.8 MB   â”?
â”?ç£ç›˜ I/O     â”?10/ç§?   â”?5/ç§?    â”?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
```

---

## ä¸ƒã€æ•…éšœæ’æŸ?

### 7.1 å¸¸è§é—®é¢˜

#### é—®é¢˜ 1ï¼šæ’ä»¶æ²¡æœ‰è‡ªåŠ¨é‡æ–°åŠ è½?

**æ’æŸ¥æ­¥éª¤**ï¼?

1. **æ£€æŸ?Auto Reload æ˜¯å¦å¯ç”¨**ï¼?
   ```
   è®¾ç½® â†?ç¬¬ä¸‰æ–¹æ’ä»?â†?Auto Reload â†?ç¡®è®¤å¼€å…³æ‰“å¼€
   ```

2. **æ£€æŸ¥ä½ çš„å¼€å‘æ’ä»¶æ˜¯å¦å¯ç”?*ï¼?
   ```
   è®¾ç½® â†?ç¬¬ä¸‰æ–¹æ’ä»?â†?ä½ çš„æ’ä»¶ â†?ç¡®è®¤å¼€å…³æ‰“å¼€
   ```

3. **æ£€æŸ¥ç›‘æ§æ¨¡å¼å’Œåˆ—è¡¨**ï¼?
   ```
   è®¾ç½® â†?Auto Reload â†?æŸ¥çœ‹"å½“å‰çŠ¶æ€?
   ç¡®è®¤ä½ çš„æ’ä»¶åœ¨ç›‘æ§åˆ—è¡¨ä¸­
   ```

4. **æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿?*ï¼?
   ```
   Cmd+Option+I (Mac) æˆ?Ctrl+Shift+I (Windows)
   æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ?
   ```

5. **æ‰‹åŠ¨æµ‹è¯•æ–‡ä»¶æ˜¯å¦æ›´æ–°**ï¼?
   ```bash
   # æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹æ—¶é—´
   ls -lt ~/.../plugins/ä½ çš„æ’ä»¶/main.js
   
   # æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶
   echo "// test" >> ~/.../plugins/ä½ çš„æ’ä»¶/main.js
   ```

#### é—®é¢˜ 2ï¼šæ™ºèƒ½æ¨¡å¼è¯†åˆ«ä¸åˆ°æˆ‘çš„æ’ä»?

**åŸå› **ï¼šæ’ä»¶å¯èƒ½ä¸ç¬¦åˆè¯†åˆ«ç‰¹å¾ã€?

**è§£å†³æ–¹æ³•**ï¼?

1. **æ£€æŸ¥ä½ çš„æ„å»ºé…ç½®æ˜¯å¦åŒ…å?source map**ï¼?
   ```javascript
   // rollup.config.js
   output: {
     sourcemap: 'inline'  // æˆ?true
   }
   ```

2. **é™ä½æ™ºèƒ½è¯†åˆ«é˜ˆå€?*ï¼?
   ```
   è®¾ç½® â†?Auto Reload â†?æ™ºèƒ½è¯†åˆ«é˜ˆå€?â†?æ”¹ä¸ºæ›´å¤§çš„å€¼ï¼ˆå¦?48 å°æ—¶ï¼?
   ```

3. **æ‰‹åŠ¨é‡æ–°è¯†åˆ«**ï¼?
   ```
   è®¾ç½® â†?Auto Reload â†?ç‚¹å‡»"é‡æ–°è¯†åˆ«"æŒ‰é’®
   ```

4. **ä¸´æ—¶åˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼?*ï¼?
   ```
   è®¾ç½® â†?Auto Reload â†?ç›‘æ§æ¨¡å¼ â†?æ‰‹åŠ¨æ¨¡å¼ â†?å‹¾é€‰ä½ çš„æ’ä»?
   ```

#### é—®é¢˜ 3ï¼šé‡è½½åæ’ä»¶è¡Œä¸ºå¼‚å¸¸

**åŸå› **ï¼šæ’ä»¶çš„çŠ¶æ€æ²¡æœ‰æ­£ç¡®æ¸…ç†ã€?

**è§£å†³æ–¹æ³•**ï¼?

åœ¨ä½ çš„æ’ä»¶ä¸­æ­£ç¡®å®ç° `onunload()` æ–¹æ³•ï¼?

```javascript
export default class MyPlugin extends Plugin {
  onload() {
    // åˆå§‹åŒ?
    this.registerEvent(...);
    this.addCommand(...);
  }
  
  onunload() {
    // âš ï¸ é‡è¦ï¼šæ¸…ç†æ‰€æœ‰èµ„æº?
    // Obsidian ä¼šè‡ªåŠ¨æ¸…ç†å¤§éƒ¨åˆ†èµ„æºï¼Œä½†æŸäº›éœ€è¦æ‰‹åŠ¨æ¸…ç?
    
    // æ¸…ç†å®šæ—¶å™?
    if (this.intervalId) {
      clearInterval(this.intervalId);
    }
    
    // æ¸…ç† DOM å…ƒç´ 
    this.containerEl?.remove();
    
    // å…¶ä»–æ¸…ç†å·¥ä½œ...
  }
}
```

#### é—®é¢˜ 4ï¼šObsidian å˜å¡

**åŸå› **ï¼šæ£€æŸ¥é—´éš”å¤ªçŸ­æˆ–ç›‘æ§æ’ä»¶å¤ªå¤šã€?

**è§£å†³æ–¹æ³•**ï¼?

```
è®¾ç½® â†?Auto Reload â†?æ£€æŸ¥é—´éš?â†?æ”¹ä¸º 2000ï¼?ç§’ï¼‰
```

æˆ–å‡å°‘ç›‘æ§çš„æ’ä»¶æ•°é‡ã€?

### 7.2 è°ƒè¯•å‘½ä»¤

åœ?Obsidian æ§åˆ¶å°ä¸­è¿è¡Œï¼?

```javascript
// æŸ¥çœ‹å½“å‰ç›‘æ§çš„æ’ä»?
app.plugins.plugins['auto-reload'].watchedPlugins

// æŸ¥çœ‹ç¼“å­˜çš„ä¿®æ”¹æ—¶é—?
app.plugins.plugins['auto-reload'].lastModifiedTimes

// æŸ¥çœ‹å½“å‰è®¾ç½®
app.plugins.plugins['auto-reload'].settings

// æ‰‹åŠ¨è§¦å‘é‡æ–°è¯†åˆ«
await app.plugins.plugins['auto-reload'].identifyDevPlugins()

// æ‰‹åŠ¨é‡è½½æŸä¸ªæ’ä»¶
await app.plugins.disablePlugin('my-plugin')
await app.plugins.enablePlugin('my-plugin')
```

---

## å…«ã€å¼€å‘å·¥å…·é“¾é›†æˆ

### 8.1 ä¸?rollup é›†æˆ

**packages/plugin/rollup.config.js**ï¼?

```javascript
import typescript from 'rollup-plugin-typescript2';
import { nodeResolve } from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import copy from 'rollup-plugin-copy';

const VAULT_PATH = process.env.VAULT_PATH || 
  '/Users/LINYF510/Documents/MyVault';
const PLUGIN_ID = 'my-awesome-plugin';
const OUTPUT_DIR = `${VAULT_PATH}/.obsidian/plugins/${PLUGIN_ID}`;

const isDev = process.env.NODE_ENV !== 'production';

export default {
  input: 'src/main.ts',
  output: {
    file: `${OUTPUT_DIR}/main.js`,
    format: 'cjs',
    sourcemap: isDev ? 'inline' : false,  // å¼€å‘æ—¶åŒ…å« source map
    exports: 'default'
  },
  plugins: [
    typescript({
      tsconfigOverride: {
        compilerOptions: {
          declaration: false
        }
      }
    }),
    nodeResolve({ browser: true }),
    commonjs(),
    copy({
      targets: [
        { src: 'manifest.json', dest: OUTPUT_DIR },
        { src: 'styles.css', dest: OUTPUT_DIR }
      ],
      hook: 'writeBundle'
    })
  ],
  external: ['obsidian']
};
```

**package.json**ï¼?

```json
{
  "scripts": {
    "dev": "NODE_ENV=development VAULT_PATH=$HOME/Documents/MyVault rollup -c -w",
    "build": "NODE_ENV=production rollup -c"
  }
}
```

### 8.2 ä¸?Monorepo é›†æˆ

**æ ¹ç›®å½?package.json**ï¼?

```json
{
  "name": "my-monorepo",
  "scripts": {
    "dev": "concurrently \"pnpm dev:plugin\" \"pnpm dev:mcp\"",
    "dev:plugin": "pnpm --filter @org/plugin dev",
    "dev:mcp": "pnpm --filter @org/mcp dev"
  }
}
```

**ä½¿ç”¨æµç¨‹**ï¼?

```bash
# 1. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä¸€æ¬¡æ€§ï¼‰
export VAULT_PATH="$HOME/Documents/MyVault"

# 2. å¯åŠ¨å¼€å?
pnpm dev

# ç°åœ¨ï¼?
# - æ’ä»¶è‡ªåŠ¨ç¼–è¯‘å¹¶è¾“å‡ºåˆ° Vault
# - Auto Reload è‡ªåŠ¨æ£€æµ‹å¹¶é‡æ–°åŠ è½½
# - MCP æœåŠ¡åŒæ—¶è¿è¡Œ
# - å®Œæ•´çš„å¼€å‘ç¯å¢?âœ?
```

---

## ä¹ã€æœªæ¥æ‰©å±?

### 9.1 è®¡åˆ’ä¸­çš„åŠŸèƒ½

#### åŠŸèƒ½ 1ï¼šç›‘æ§å¤šç§æ–‡ä»¶ç±»å?

```javascript
// ä¸ä»…ç›‘æ§ main.jsï¼Œè¿˜ç›‘æ§å…¶ä»–æ–‡ä»¶
const filesToWatch = ['main.js', 'styles.css', 'manifest.json'];

for (const file of filesToWatch) {
  await this.checkFile(pluginId, file);
}
```

#### åŠŸèƒ½ 2ï¼šæ‰¹é‡é‡è½½ä¼˜åŒ?

```javascript
// å¦‚æœçŸ­æ—¶é—´å†…å¤šä¸ªæ–‡ä»¶å˜åŒ–ï¼Œåªé‡è½½ä¸€æ¬?
this.pendingReloads.add(pluginId);
clearTimeout(this.reloadTimer);
this.reloadTimer = setTimeout(() => {
  for (const id of this.pendingReloads) {
    await this.reloadPlugin(id);
  }
  this.pendingReloads.clear();
}, 500);
```

#### åŠŸèƒ½ 3ï¼šé‡è½½ç»Ÿè®?

```javascript
// è®°å½•é‡è½½æ¬¡æ•°å’Œæ—¶é—?
this.stats = {
  totalReloads: 0,
  lastReloadTime: null,
  reloadHistory: []
};

// åœ¨è®¾ç½®é¡µé¢æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ?
```

#### åŠŸèƒ½ 4ï¼šæ¡ä»¶é‡è½?

```javascript
// åªåœ¨æ»¡è¶³æ¡ä»¶æ—¶é‡è½?
if (this.settings.onlyReloadWhenFocused) {
  if (!document.hasFocus()) {
    console.log('Obsidian æœªèšç„¦ï¼Œè·³è¿‡é‡è½½');
    return;
  }
}
```

### 9.2 ç¤¾åŒºè´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼?
- æŠ¥å‘Š Bug
- æå‡ºæ–°åŠŸèƒ½å»ºè®?
- æäº¤ Pull Request
- æ”¹è¿›æ–‡æ¡£

GitHub ä»“åº“ï¼ˆè®¡åˆ’ï¼‰ï¼?
```
https://github.com/LINYF510/obsidian-auto-reload
```

---

## åã€æ€»ç»“

### 10.1 æ–¹æ¡ˆä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **æ™ºèƒ½åŒ?* | è‡ªåŠ¨è¯†åˆ«å¼€å‘æ’ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½® |
| **çµæ´»æ€?* | ä¸‰ç§æ¨¡å¼æ»¡è¶³ä¸åŒéœ€æ±?|
| **ç”¨æˆ·å‹å¥½** | å¯è§†åŒ–è®¾ç½®ç•Œé¢ï¼Œæ˜“äºä½¿ç”¨ |
| **æ€§èƒ½ä¼˜å¼‚** | è½»é‡çº§å®ç°ï¼Œå‡ ä¹æ— æ€§èƒ½å½±å“ |
| **å¯é æ€?* | ç»è¿‡å……åˆ†æµ‹è¯•ï¼Œç¨³å®šå¯é?|
| **å¯æ‰©å±?* | æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±• |

### 10.2 é€‚ç”¨åœºæ™¯

âœ?**æ¨èä½¿ç”¨**ï¼?
- Obsidian æ’ä»¶å¼€å?
- éœ€è¦é¢‘ç¹ä¿®æ”¹æµ‹è¯?
- Monorepo ä¸­çš„æ’ä»¶å¼€å?
- Hot Reload ä¸å·¥ä½œçš„æƒ…å†µ

â?**ä¸é€‚ç”¨**ï¼?
- æ™®é€šç”¨æˆ·ï¼ˆéå¼€å‘è€…ï¼‰
- åªä½¿ç”¨ç¤¾åŒºæ’ä»?
- ä¸éœ€è¦è‡ªåŠ¨é‡è½½åŠŸèƒ?

### 10.3 å¿«é€Ÿå¼€å§?

```bash
# 1. å®‰è£… Auto Reload æ’ä»¶
cd ~/Documents/ä½ çš„Vault/.obsidian/plugins/
mkdir auto-reload
# å¤åˆ¶ manifest.json å’?main.js

# 2. åœ?Obsidian ä¸­å¯ç”?
è®¾ç½® â†?ç¬¬ä¸‰æ–¹æ’ä»?â†?å¯ç”¨ Auto Reload

# 3. å¼€å§‹å¼€å?
npm run dev

# 4. äº«å—è‡ªåŠ¨é‡è½½ âœ?
```

---

## åä¸€ã€é™„å½?

### 11.1 å®Œæ•´æ–‡ä»¶æ¸…å•

```
.obsidian/plugins/auto-reload/
â”œâ”€â”€ manifest.json      (æ’ä»¶æ¸…å• - 89 å­—èŠ‚)
â””â”€â”€ main.js           (æ ¸å¿ƒä»£ç  - çº?25KB)
```

### 11.2 ç›¸å…³èµ„æº

- **Obsidian Plugin API**ï¼šhttps://github.com/obsidianmd/obsidian-api
- **Obsidian æ’ä»¶å¼€å‘æŒ‡å?*ï¼šhttps://docs.obsidian.md/Plugins
- **TypeScript å®˜æ–¹æ–‡æ¡£**ï¼šhttps://www.typescriptlang.org/
- **Rollup æ„å»ºå·¥å…·**ï¼šhttps://rollupjs.org/

### 11.3 è®¸å¯è¯?

æœ¬æ–¹æ¡ˆåŠä»£ç é‡‡ç”¨ **MIT è®¸å¯è¯?*ï¼Œå¯è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘ã€?

### 11.4 æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| v2.0.0 | 2025-11-01 | ä¸‰æ¨¡å¼æ•´åˆç‰ˆæœ?|
| v1.0.0 | 2025-10-31 | åˆå§‹ç‰ˆæœ¬ |

---

**è®¾è®¡ä¹¦ç‰ˆæœ?*ï¼šv2.0  
**æœ€åæ›´æ–?*ï¼?025-11-01 19:01:55 UTC  
**ä½œè€?*ï¼šLINYF510  
**è”ç³»æ–¹å¼**ï¼šGitHub @LINYF510  

---

## éœ€è¦æˆ‘åšä»€ä¹ˆï¼Ÿ

ç°åœ¨æˆ‘å¯ä»¥ä¸ºä½ ï¼š

1. âœ?**ç”Ÿæˆå®Œæ•´çš„å¯ç”¨æ–‡ä»?*ï¼ˆmanifest.json + main.jsï¼?
2. âœ?**ä¸ºä½ çš„é¡¹ç›®é…ç½?rollup.config.js**
3. âœ?**åˆ›å»º package.json è„šæœ¬**
4. âœ?**ç¼–å†™è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡?*
5. âœ?**åˆ›å»º GitHub ä»“åº“æ¨¡æ¿**

å‘Šè¯‰æˆ‘ä½ éœ€è¦å“ªä¸ªï¼Œæˆ‘ç«‹åˆ»ç”Ÿæˆï¼ğŸš€