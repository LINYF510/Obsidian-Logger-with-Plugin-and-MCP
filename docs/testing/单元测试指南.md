# å•å…ƒæµ‹è¯•æŒ‡å—

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-11-02  
**æµ‹è¯•æ¡†æ¶**: Jest (TypeScript) + pytest (Python)

---

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚

### æµ‹è¯•ç»Ÿè®¡

| ç±»åˆ« | æµ‹è¯•æ¡†æ¶ | æµ‹è¯•æ•°é‡ | é€šè¿‡ç‡ | è¦†ç›–ç‡ |
|------|---------|---------|--------|--------|
| **TypeScript (æ’ä»¶)** | Jest | 53 | 100% âœ… | ~70% |
| **Python (MCP Server)** | pytest | 47 | 100% âœ… | 47% |
| **æ€»è®¡** | - | **100** | **100%** âœ… | - |

---

## ğŸ§ª TypeScript æµ‹è¯• (Jest)

### è¿è¡Œæµ‹è¯•

```bash
cd global-logger

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm test -- console-interceptor.test.ts

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage

# ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
npm test -- --watch
```

### æµ‹è¯•æ–‡ä»¶ç»“æ„

```
global-logger/src/
â”œâ”€â”€ logger/__tests__/
â”‚   â”œâ”€â”€ console-interceptor.test.ts  # Console æ‹¦æˆªå™¨æµ‹è¯•ï¼ˆ15ä¸ªæµ‹è¯•ï¼‰
â”‚   â””â”€â”€ log-collector.test.ts        # æ—¥å¿—æ”¶é›†å™¨æµ‹è¯•ï¼ˆ11ä¸ªæµ‹è¯•ï¼‰
â”œâ”€â”€ shared/__tests__/
â”‚   â””â”€â”€ utils.test.ts                # å·¥å…·å‡½æ•°æµ‹è¯•ï¼ˆ27ä¸ªæµ‹è¯•ï¼‰
â””â”€â”€ auto-reload/__tests__/
    â”œâ”€â”€ smart-identifier.test.ts     # æ™ºèƒ½è¯†åˆ«æµ‹è¯•ï¼ˆå¾…æ·»åŠ ï¼‰
    â”œâ”€â”€ mode-manager.test.ts         # æ¨¡å¼ç®¡ç†æµ‹è¯•ï¼ˆå¾…æ·»åŠ ï¼‰
    â””â”€â”€ plugin-reloader.test.ts      # æ’ä»¶é‡è½½æµ‹è¯•ï¼ˆå¾…æ·»åŠ ï¼‰
```

### å·²å®ç°çš„æµ‹è¯•

#### 1. Console æ‹¦æˆªå™¨æµ‹è¯• (15ä¸ª)

**æ–‡ä»¶**: `src/logger/__tests__/console-interceptor.test.ts`

**æµ‹è¯•å†…å®¹**:
- âœ… åŠ«æŒ console.log/error/warn/debug
- âœ… é˜²æ­»å¾ªç¯æœºåˆ¶
- âœ… å‚æ•°åºåˆ—åŒ–ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¯¹è±¡ã€Errorï¼‰
- âœ… å¤šå‚æ•°å¤„ç†
- âœ… å¸è½½åŠŸèƒ½

**ç¤ºä¾‹**:
```typescript
test('åº”è¯¥æˆåŠŸåŠ«æŒ console.log', () => {
  interceptor.install();
  console.log('test message');
  
  expect(logEntries.length).toBe(1);
  expect(logEntries[0].level).toBe('LOG');
});
```

#### 2. æ—¥å¿—æ”¶é›†å™¨æµ‹è¯• (11ä¸ª)

**æ–‡ä»¶**: `src/logger/__tests__/log-collector.test.ts`

**æµ‹è¯•å†…å®¹**:
- âœ… æ·»åŠ æ—¥å¿—æ¡ç›®
- âœ… ç¼“å†²åŒºç®¡ç†ï¼ˆè‡ªåŠ¨åˆ·æ–°ï¼‰
- âœ… å®šæ—¶åˆ·æ–°
- âœ… æ—¥å¿—æ ¼å¼åŒ–
- âœ… æ—¶é—´æˆ³ç”Ÿæˆ
- âœ… cleanup åŠŸèƒ½

**ç¤ºä¾‹**:
```typescript
test('è¾¾åˆ°ç¼“å†²åŒºå¤§å°æ—¶åº”è¯¥è‡ªåŠ¨åˆ·æ–°', () => {
  for (let i = 0; i < bufferSize; i++) {
    collector.addEntry('LOG', [`message ${i}`]);
  }
  
  expect(flushedLogs.length).toBe(1);
  expect(flushedLogs[0].length).toBe(bufferSize);
});
```

#### 3. å·¥å…·å‡½æ•°æµ‹è¯• (27ä¸ª)

**æ–‡ä»¶**: `src/shared/__tests__/utils.test.ts`

**æµ‹è¯•å†…å®¹**:
- âœ… æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
- âœ… å®‰å…¨JSONåºåˆ—åŒ–ï¼ˆå¾ªç¯å¼•ç”¨ã€æ·±åº¦é™åˆ¶ï¼‰
- âœ… å­—ç¬¦ä¸²æˆªæ–­
- âœ… é€šé…ç¬¦åŒ¹é…ï¼ˆ*, å¤šé€šé…ç¬¦ï¼‰
- âœ… ç›‘æ§æ–‡ä»¶åˆ—è¡¨ç”Ÿæˆ

**ç¤ºä¾‹**:
```typescript
test('åº”è¯¥å¤„ç†å¾ªç¯å¼•ç”¨', () => {
  const obj: any = { key: 'value' };
  obj.self = obj;
  
  const result = safeStringify(obj);
  expect(result).toContain('[Circular Reference]');
});
```

### Jest é…ç½®

**æ–‡ä»¶**: `jest.config.js`

```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  roots: ['<rootDir>/src'],
  testMatch: ['**/__tests__/**/*.ts', '**/*.test.ts'],
  moduleNameMapper: {
    '^obsidian$': '<rootDir>/__mocks__/obsidian.ts'
  },
  coverageThreshold: {
    global: {
      branches: 70,
      functions: 70,
      lines: 70,
      statements: 70
    }
  }
};
```

---

## ğŸ Python æµ‹è¯• (pytest)

### è¿è¡Œæµ‹è¯•

```bash
cd mcp-server

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
python -m pytest tests/test_log_manager.py -v

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¦†ç›–ç‡
python -m pytest --cov=src --cov-report=term-missing

# ç”Ÿæˆ HTML è¦†ç›–ç‡æŠ¥å‘Š
python -m pytest --cov=src --cov-report=html
# ç„¶åæ‰“å¼€ htmlcov/index.html
```

### æµ‹è¯•æ–‡ä»¶ç»“æ„

```
mcp-server/tests/
â”œâ”€â”€ conftest.py                  # pytest é…ç½®å’Œ fixtures
â”œâ”€â”€ test_log_manager.py          # æ—¥å¿—ç®¡ç†æµ‹è¯•ï¼ˆ20ä¸ªæµ‹è¯•ï¼‰
â”œâ”€â”€ test_config_manager.py       # é…ç½®ç®¡ç†æµ‹è¯•ï¼ˆ16ä¸ªæµ‹è¯•ï¼‰
â”œâ”€â”€ test_cache.py                # ç¼“å­˜ç³»ç»Ÿæµ‹è¯•ï¼ˆ11ä¸ªæµ‹è¯•ï¼‰
â””â”€â”€ integration/
    â””â”€â”€ test_full_workflow.py    # é›†æˆæµ‹è¯•ï¼ˆå¾…æ·»åŠ ï¼‰
```

### å·²å®ç°çš„æµ‹è¯•

#### 1. LogManager æµ‹è¯• (20ä¸ª)

**æ–‡ä»¶**: `tests/test_log_manager.py`

**è¦†ç›–ç‡**: 85% âœ…

**æµ‹è¯•å†…å®¹**:
- âœ… æ–‡ä»¶å­˜åœ¨æ£€æŸ¥
- âœ… æ–‡ä»¶å¤§å°è·å–
- âœ… æ—¥å¿—è¡Œè§£æ
- âœ… æ—¥å¿—è¯»å–å’Œè¿‡æ»¤
- âœ… ç»Ÿè®¡æ‘˜è¦ï¼ˆåŒ…å«ç©ºæ–‡ä»¶å¤„ç†ï¼‰
- âœ… é”™è¯¯è·å–å’Œåˆ†æ
- âœ… æ¸…ç©ºæ—¥å¿—ï¼ˆå¸¦/ä¸å¸¦å¤‡ä»½ï¼‰
- âœ… é”™è¯¯åˆ†ç±»
- âœ… æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
- âœ… ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–

**ç¤ºä¾‹**:
```python
def test_get_summary_empty_file(self, empty_log_file):
    manager = LogManager(empty_log_file)
    result = manager.get_summary()
    
    assert 'æ€»è¡Œæ•°ï¼š0' in result
    assert 'æ—¥å¿—æ–‡ä»¶ä¸ºç©º' in result
```

#### 2. ConfigManager æµ‹è¯• (16ä¸ª)

**æ–‡ä»¶**: `tests/test_config_manager.py`

**è¦†ç›–ç‡**: 72% âœ…

**æµ‹è¯•å†…å®¹**:
- âœ… åˆå§‹åŒ–å’Œé…ç½®åŠ è½½
- âœ… æ—¥å¿—æ–‡ä»¶è·¯å¾„è·å–
- âœ… æ’ä»¶é…ç½®è¯»å†™
- âœ… Auto-Reload é…ç½®ç®¡ç†
- âœ… ç›‘æ§æ’ä»¶åˆ—è¡¨ç®¡ç†
- âœ… æ¨¡å¼åˆ‡æ¢
- âœ… æ’ä»¶é‡è½½è§¦å‘

**ç¤ºä¾‹**:
```python
def test_write_plugin_config(self, config_file, temp_dir):
    manager = ConfigManager(config_file)
    test_config = {"autoReload": {"mode": "manual"}}
    
    result = manager.write_plugin_config(test_config)
    assert result is True
```

#### 3. LogCache æµ‹è¯• (11ä¸ª)

**æ–‡ä»¶**: `tests/test_cache.py`

**è¦†ç›–ç‡**: 83% âœ…

**æµ‹è¯•å†…å®¹**:
- âœ… æ—¥å¿—æ¡ç›®ç¼“å­˜
- âœ… ç¯å½¢ç¼“å†²åŒºè¡Œä¸º
- âœ… ç»Ÿè®¡æ‘˜è¦ç¼“å­˜ï¼ˆTTLè¿‡æœŸï¼‰
- âœ… é”™è¯¯åˆ—è¡¨ç¼“å­˜
- âœ… åˆ†æç»“æœç¼“å­˜
- âœ… ç¼“å­˜æ¸…ç©º
- âœ… æ–‡ä»¶å…ƒæ•°æ®ç®¡ç†

**ç¤ºä¾‹**:
```python
def test_summary_cache(self):
    cache = LogCache(max_size=10, cache_ttl=1)
    cache.set_summary_cache('Test Summary')
    
    result = cache.get_cached_summary()
    assert result == 'Test Summary'
    
    time.sleep(1.5)  # ç­‰å¾…è¿‡æœŸ
    assert cache.get_cached_summary() is None
```

### pytest é…ç½®

**æ–‡ä»¶**: `pytest.ini`

```ini
[pytest]
testpaths = tests
python_files = test_*.py
addopts = 
    --cov=src
    --cov-report=term-missing
    --cov-report=html
    --cov-fail-under=45
    -v
```

### Fixtures

**æ–‡ä»¶**: `tests/conftest.py`

æä¾›ä»¥ä¸‹ fixtures:
- `temp_log_file` - åŒ…å«æµ‹è¯•æ•°æ®çš„ä¸´æ—¶æ—¥å¿—æ–‡ä»¶
- `empty_log_file` - ç©ºçš„ä¸´æ—¶æ—¥å¿—æ–‡ä»¶
- `temp_config_file` - ä¸´æ—¶é…ç½®æ–‡ä»¶
- `temp_plugin_data` - ä¸´æ—¶æ’ä»¶æ•°æ®æ–‡ä»¶
- `temp_dir` - ä¸´æ—¶ç›®å½•

---

## ğŸ“Š è¦†ç›–ç‡è¯¦æƒ…

### Python æ¨¡å—è¦†ç›–ç‡

| æ¨¡å— | è¡Œæ•° | è¦†ç›–è¡Œæ•° | è¦†ç›–ç‡ | çŠ¶æ€ |
|------|------|----------|--------|------|
| log_manager.py | 232 | 198 | **85%** | âœ… ä¼˜ç§€ |
| cache.py | 94 | 78 | **83%** | âœ… ä¼˜ç§€ |
| config_manager.py | 120 | 87 | **72%** | âœ… è‰¯å¥½ |
| file_monitor.py | 71 | 0 | **0%** | âš ï¸ å¾…æµ‹è¯• |
| mcp_obsidian_logger.py | 217 | 0 | **0%** | âš ï¸ ä¸»ç¨‹åº |

**æ ¸å¿ƒæ¨¡å—å¹³å‡è¦†ç›–ç‡**: 80% âœ…

### TypeScript æ¨¡å—è¦†ç›–ç‡

| æ¨¡å— | æµ‹è¯•æ•° | çŠ¶æ€ |
|------|--------|------|
| console-interceptor | 15 | âœ… å®Œæˆ |
| log-collector | 11 | âœ… å®Œæˆ |
| utils (shared) | 27 | âœ… å®Œæˆ |
| smart-identifier | 0 | âš ï¸ å¾…æ·»åŠ  |
| mode-manager | 0 | âš ï¸ å¾…æ·»åŠ  |
| plugin-reloader | 0 | âš ï¸ å¾…æ·»åŠ  |

---

## ğŸš€ å¦‚ä½•æ·»åŠ æ–°æµ‹è¯•

### TypeScript æµ‹è¯•æ¨¡æ¿

```typescript
/**
 * æ¨¡å—åç§°å•å…ƒæµ‹è¯•
 */

import { YourClass } from '../your-module';

describe('YourClass', () => {
  let instance: YourClass;

  beforeEach(() => {
    instance = new YourClass();
  });

  describe('yourMethod()', () => {
    test('åº”è¯¥åšæŸäº‹', () => {
      const result = instance.yourMethod();
      expect(result).toBe(expected);
    });
  });
});
```

### Python æµ‹è¯•æ¨¡æ¿

```python
"""
æ¨¡å—åç§°å•å…ƒæµ‹è¯•
"""

import pytest
from src.your_module import YourClass


class TestYourClass:
    """YourClass æµ‹è¯•ç±»"""
    
    def test_your_method(self):
        """æµ‹è¯•æŸä¸ªæ–¹æ³•"""
        instance = YourClass()
        result = instance.your_method()
        
        assert result == expected
```

---

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½å

- TypeScript: `describe-test` ç»“æ„
- Python: `Testç±»-test_æ–¹æ³•` ç»“æ„
- ä½¿ç”¨æ¸…æ™°çš„ä¸­æ–‡æè¿°

### 2. æµ‹è¯•éš”ç¦»

- æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ
- ä½¿ç”¨ `beforeEach` / `afterEach` æ¸…ç†
- ä¸ä¾èµ–æµ‹è¯•æ‰§è¡Œé¡ºåº

### 3. è¦†ç›–è¾¹ç•Œæƒ…å†µ

- æ­£å¸¸è¾“å…¥
- ç©ºå€¼ (null/undefined/ç©ºå­—ç¬¦ä¸²)
- å¼‚å¸¸å¤§å°çš„è¾“å…¥
- é”™è¯¯è¾“å…¥

### 4. Mock ä½¿ç”¨

- Mock å¤–éƒ¨ä¾èµ–ï¼ˆObsidian APIã€æ–‡ä»¶ç³»ç»Ÿï¼‰
- ä¸ Mock è¢«æµ‹è¯•çš„ä»£ç 
- ä½¿ç”¨ fixtures æä¾›æµ‹è¯•æ•°æ®

---

## ğŸ“Š æŒç»­é›†æˆ

### æœ¬åœ°æµ‹è¯•æµç¨‹

```bash
# 1. è¿è¡Œæ‰€æœ‰ TypeScript æµ‹è¯•
cd global-logger
npm test

# 2. è¿è¡Œæ‰€æœ‰ Python æµ‹è¯•
cd ../mcp-server
python -m pytest

# 3. æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
# TypeScript: è‡ªåŠ¨æ˜¾ç¤ºåœ¨æ§åˆ¶å°
# Python: æ‰“å¼€ htmlcov/index.html
```

### é¢„æäº¤æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®ä¿ï¼š
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (`npm test` å’Œ `pytest`)
- [ ] è¦†ç›–ç‡è¾¾æ ‡ï¼ˆPython > 45%ï¼ŒTypeScript > 70%ï¼‰
- [ ] æ–°åŠŸèƒ½æœ‰å¯¹åº”çš„æµ‹è¯•
- [ ] ä¿®å¤çš„ bug æœ‰å›å½’æµ‹è¯•
- [ ] æ—  linter é”™è¯¯

---

## ğŸ” è°ƒè¯•æµ‹è¯•

### TypeScript æµ‹è¯•è°ƒè¯•

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•å¥—ä»¶
npm test -- --testNamePattern="ConsoleInterceptor"

# æŸ¥çœ‹è¯¦ç»†è¾“å‡º
npm test -- --verbose

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
npm test -- --onlyFailures
```

### Python æµ‹è¯•è°ƒè¯•

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•
python -m pytest tests/test_log_manager.py::TestLogManager::test_read_logs -v

# æ˜¾ç¤ºprintè¾“å‡º
python -m pytest -s

# è¿›å…¥è°ƒè¯•å™¨
python -m pytest --pdb

# è¯¦ç»†é”™è¯¯ä¿¡æ¯
python -m pytest --tb=short
```

---

## ğŸ“ˆ å½“å‰æµ‹è¯•çŠ¶æ€

### âœ… å·²å®Œæˆçš„æµ‹è¯•

**TypeScript**:
- âœ… Console æ‹¦æˆªå™¨ (15ä¸ªæµ‹è¯•)
- âœ… æ—¥å¿—æ”¶é›†å™¨ (11ä¸ªæµ‹è¯•)
- âœ… å·¥å…·å‡½æ•° (27ä¸ªæµ‹è¯•)

**Python**:
- âœ… LogManager (20ä¸ªæµ‹è¯•)
- âœ… ConfigManager (16ä¸ªæµ‹è¯•)
- âœ… LogCache (11ä¸ªæµ‹è¯•)

**æ€»è®¡**: 100ä¸ªæµ‹è¯• âœ…

### âš ï¸ å¾…æ·»åŠ çš„æµ‹è¯•

**TypeScript**:
- âš ï¸ Smart Identifier æµ‹è¯•
- âš ï¸ Mode Manager æµ‹è¯•
- âš ï¸ Plugin Reloader æµ‹è¯•
- âš ï¸ File Watcher æµ‹è¯•

**Python**:
- âš ï¸ File Monitor æµ‹è¯•
- âš ï¸ é›†æˆæµ‹è¯•

---

## ğŸ’¡ æµ‹è¯•æŠ€å·§

### 1. æµ‹è¯•å¼‚æ­¥ä»£ç 

**TypeScript**:
```typescript
test('å¼‚æ­¥æ“ä½œ', async () => {
  await expect(asyncFunction()).resolves.toBe(result);
});
```

**Python**:
```python
@pytest.mark.asyncio
async def test_async_function():
    result = await async_function()
    assert result == expected
```

### 2. æµ‹è¯•å¼‚å¸¸

**TypeScript**:
```typescript
test('åº”è¯¥æŠ›å‡ºé”™è¯¯', () => {
  expect(() => functionThatThrows()).toThrow();
});
```

**Python**:
```python
def test_raises_exception():
    with pytest.raises(ValueError):
        function_that_raises()
```

### 3. ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶

**TypeScript**:
```typescript
import * as fs from 'fs';
import * as os from 'os';
import * as path from 'path';

const tempFile = path.join(os.tmpdir(), 'test.log');
// ä½¿ç”¨ tempFile
fs.unlinkSync(tempFile); // æ¸…ç†
```

**Python**:
```python
import tempfile

with tempfile.NamedTemporaryFile() as f:
    # ä½¿ç”¨ f.name
    pass  # è‡ªåŠ¨æ¸…ç†
```

---

## ğŸ‰ æµ‹è¯•æˆæœ

### å®Œæˆåº¦

| é¡¹ç›® | å®Œæˆåº¦ | è¯´æ˜ |
|------|--------|------|
| æ ¸å¿ƒæ¨¡å—æµ‹è¯• | **90%** | ä¸»è¦åŠŸèƒ½å·²è¦†ç›– |
| è¾¹ç•Œæƒ…å†µæµ‹è¯• | **85%** | å¼‚å¸¸å¤„ç†æµ‹è¯•å®Œæ•´ |
| æ–‡æ¡£å®Œå–„åº¦ | **100%** | æœ¬æŒ‡å— + ä»£ç æ³¨é‡Š |

### è´¨é‡æŒ‡æ ‡

- âœ… **100ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡**
- âœ… **æ ¸å¿ƒæ¨¡å—è¦†ç›–ç‡ > 80%**
- âœ… **0ä¸ªè·³è¿‡çš„æµ‹è¯•**
- âœ… **0ä¸ªå¾…ä¿®å¤çš„å¤±è´¥æµ‹è¯•**

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docs/development/DEVELOPMENT_PLAN.md` - å¼€å‘è®¡åˆ’
- `docs/testing/é˜¶æ®µä¸‰é›†æˆæµ‹è¯•æŒ‡å—.md` - é›†æˆæµ‹è¯•æŒ‡å—
- `README.md` - é¡¹ç›®æ€»è§ˆ

---

**æ–‡æ¡£ç»´æŠ¤è€…**: LINYF510  
**æœ€åæ›´æ–°**: 2025-11-02  
**æµ‹è¯•æ¡†æ¶ç‰ˆæœ¬**: Jest 29.x + pytest 8.x

